<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Profile v19.15 (Layout Update)</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;800;900&display=swap" rel="stylesheet">
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
  :root {
    --bg-dark: #020617; 
    --glass: rgba(15, 23, 42, 0.9);
    --glass-border: rgba(255,255,255,0.1);
    --primary-m: #3b82f6;
    --accent: #8b5cf6;
    --success: #10b981; --danger: #ef4444;
    --font-stack: "Pretendard", -apple-system, sans-serif;
  }
  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
  
  body {
    font-family: var(--font-stack);
    background: #0f172a;
    background-image: 
      radial-gradient(circle at 0% 0%, rgba(59, 130, 246, 0.15) 0%, transparent 50%),
      radial-gradient(circle at 100% 100%, rgba(139, 92, 246, 0.15) 0%, transparent 50%);
    color: #f8fafc; margin: 0; padding: 20px; min-height: 100vh;
  }
  
  .wrap { max-width: 900px; margin: 0 auto; padding-bottom: 80px; }

  /* --- HEADER --- */
  header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 15px; }
  .brand { display: flex; align-items: center; gap: 10px; }
  .brand-logo { 
    width: 32px; height: 32px; 
    background: var(--primary-m);
    border-radius: 8px; box-shadow: 0 0 15px rgba(59, 130, 246, 0.4);
  }
  .brand h1 { 
    margin: 0; font-size: 1.6rem; font-weight: 900; letter-spacing: -0.5px;
    background: linear-gradient(135deg, #fff 30%, #94a3b8 100%);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  }
  .ver-badge { 
    font-size: 0.7rem; background: rgba(59, 130, 246, 0.15); padding: 3px 8px; border-radius: 6px; 
    color: #60a5fa; font-weight: 800; border: 1px solid rgba(59, 130, 246, 0.3); vertical-align: middle; margin-left: 8px;
  }

  .btn-group { display: flex; gap: 8px; flex-wrap: wrap; }
  .btn {
    background: rgba(30, 41, 59, 0.6); border: 1px solid var(--glass-border);
    color: #cbd5e1; padding: 8px 14px; border-radius: 10px; font-size: 0.85rem; font-weight: 600;
    cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; gap: 6px;
  }
  .btn:hover { background: rgba(255,255,255,0.1); color: #fff; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
  .btn-accent { background: var(--accent); border-color: var(--accent); color: #fff; box-shadow: 0 0 15px rgba(139, 92, 246, 0.3); }
  .btn-reset { color: var(--danger); border-color: rgba(239, 68, 68, 0.3); background: rgba(239, 68, 68, 0.05); }

  /* --- MAIN PANEL --- */
  .panel {
    background: var(--glass); backdrop-filter: blur(24px);
    border-radius: 28px; border: 1px solid var(--glass-border);
    box-shadow: 0 30px 60px -15px rgba(0,0,0,0.7); overflow: hidden; position: relative;
  }
  
  .input-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; padding: 30px; }
  .category-box { padding: 20px; background: rgba(30, 41, 59, 0.4); border-radius: 16px; border: 1px solid rgba(255,255,255,0.05); }
  
  .category-title { 
    font-size: 1.1rem; font-weight: 800; color: #fff; 
    margin-bottom: 20px; padding-bottom: 8px; 
    border-bottom: 2px solid rgba(59, 130, 246, 0.5); 
    display: flex; align-items: center; justify-content: space-between; 
  }
  
  .tier-badge {
    font-size: 0.75rem; font-weight: 900; 
    padding: 4px 10px; border-radius: 8px; 
    background: rgba(15, 23, 42, 0.8);
    border: 1px solid #334155;
    color: #94a3b8;
    text-transform: uppercase;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    transition: 0.3s ease;
  }

  /* Inputs */
  .profile-head { display: flex; gap: 16px; margin-bottom: 25px; align-items: center; }
  .avatar {
    width: 72px; height: 72px; border-radius: 20px; 
    background: #1e293b; border: 2px solid var(--glass-border);
    display: flex; align-items: center; justify-content: center; overflow: hidden;
    cursor: pointer; position: relative; transition: 0.3s; box-shadow: 0 8px 20px rgba(0,0,0,0.3);
  }
  .avatar img { width: 100%; height: 100%; object-fit: cover; }
  .avatar-icon { font-size: 32px; opacity: 0.8; }
  .info-box { flex: 1; display: flex; align-items: center; }
  .name-inp { width: 100%; background: transparent; border: none; font-size: 1.4rem; font-weight: 800; color: #fff; margin: 0; }

  .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
  .form-group { margin-bottom: 16px; }
  .lbl { display: flex; justify-content: space-between; font-size: 0.7rem; color: #64748b; font-weight: 700; margin-bottom: 6px; text-transform: uppercase; }
  .inp {
    width: 100%; background: rgba(15, 23, 42, 0.6); border: 1px solid var(--glass-border);
    border-radius: 12px; padding: 12px; color: #f1f5f9; font-size: 0.95rem; font-weight: 600;
    transition: 0.2s; font-family: var(--font-stack); cursor: pointer;
  }
  .inp:focus, .inp:active { border-color: rgba(255,255,255,0.3); background: rgba(15, 23, 42, 0.9); }
  select.inp { appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2394a3b8'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 12px center; background-size: 16px; padding-right: 40px; }

  .map-btn { text-align: left; display: flex; align-items: center; justify-content: space-between; }
  .map-btn::after { content: 'ğŸ—ºï¸'; font-size: 1.1rem; opacity: 0.7; }

  .helper { font-size: 0.75rem; color: var(--success); text-align: right; height: 16px; margin-top: 4px; font-weight: 600; opacity: 0; }
  .helper.show { opacity: 1; }
  input[type=range] { -webkit-appearance: none; background: transparent; height: 24px; width: 100%; margin: 5px 0; cursor: pointer; }
  input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 18px; width: 18px; border-radius: 50%; background: #fff; margin-top: -7px; box-shadow: 0 2px 10px rgba(0,0,0,0.3); }
  input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; background: rgba(255,255,255,0.15); border-radius: 2px; }

  /* Analysis */
  .analysis-sec { border-top: 1px solid var(--glass-border); background: linear-gradient(180deg, rgba(15,23,42,0.6) 0%, rgba(2,6,23,0.95) 100%); padding: 50px 20px; }
  
  .charts-wrapper {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-bottom: 40px;
    flex-wrap: wrap;
  }
  .chart-box {
    flex: 1;
    min-width: 300px;
    max-width: 400px;
    text-align: center;
    position: relative;
  }
  .chart-label {
    margin-top: 10px;
    font-size: 0.9rem;
    font-weight: 800;
    color: #94a3b8;
  }
  canvas { width: 100%; height: auto; cursor: crosshair; }

  .report-card { max-width: 800px; margin: 0 auto; background: rgba(30, 41, 59, 0.3); border-radius: 24px; padding: 40px; text-align: center; border: 1px solid var(--glass-border); position: relative; overflow: hidden; }
  .score-big { font-size: 5rem; font-weight: 900; background: linear-gradient(to right, #fff, #94a3b8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
  .score-rank { font-size: 1.5rem; vertical-align: super; color: var(--primary-m); }

  .breakdown-box { margin: 30px auto; max-width: 500px; }
  .bd-row { display: flex; margin-bottom: 8px; font-size: 0.85rem; color: #94a3b8; align-items: center; }
  .bd-track { flex: 1; height: 8px; background: rgba(255,255,255,0.1); margin: 0 12px; border-radius: 4px; overflow: hidden; align-self: center; }
  .bd-bar { height: 100%; width: 0; transition: width 1s; }
  
  .lifestyle-box { background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.2); padding: 20px; border-radius: 16px; margin: 30px 0; text-align: left; }
  .detail-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; text-align: left; margin-top: 40px; }
  .detail-item { background: rgba(2,6,23,0.4); padding: 20px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.03); }
  .tag { font-size: 0.7rem; padding: 2px 6px; background: rgba(255,255,255,0.1); border-radius: 4px; margin-right: 4px; }

  /* --- MODAL MAP --- */
  .modal-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(8px);
    z-index: 1000; display: none; justify-content: center; align-items: center; padding: 20px;
  }
  .modal-overlay.active { display: flex; animation: fadeIn 0.3s ease; }
  @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }

  .map-card {
    background: #1e293b; border: 1px solid var(--glass-border); border-radius: 24px;
    width: 100%; max-width: 420px; padding: 24px; position: relative;
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
  }
  .map-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
  .map-title { font-size: 1.1rem; font-weight: 800; color: #fff; }
  .close-btn { background: none; border: none; font-size: 1.5rem; color: #64748b; cursor: pointer; }

  .map-search {
    width: 100%; padding: 12px; background: #0f172a; border: 1px solid #334155;
    color: #fff; border-radius: 12px; margin-bottom: 20px; font-weight: 600;
  }
  .map-search:focus { border-color: var(--accent); }

  /* SVG Map Styles */
  .korea-map { width: 100%; height: auto; filter: drop-shadow(0 8px 10px rgba(0,0,0,0.4)); padding: 10px 0; }
  .region { fill: #334155; stroke: #0f172a; stroke-width: 1; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; }
  .region:hover { fill: #475569; transform: translateY(-3px); stroke: #94a3b8; stroke-width: 1.5; }
  .region.active { fill: var(--primary-m); stroke: #fff; stroke-width: 2; filter: drop-shadow(0 0 12px rgba(59, 130, 246, 0.7)); z-index: 10; position: relative; }
  .region-text { pointer-events: none; fill: #94a3b8; font-size: 12px; font-weight: 700; text-anchor: middle; text-shadow: 0 2px 3px rgba(0,0,0,0.8); transition: 0.3s; }
  .region.active + .region-text, .region:hover + .region-text, .region.active ~ .region-text { fill: #fff; font-weight: 900; }
  .region[data-name="ì„œìš¸"] { fill: #cbd5e1; stroke: #3b82f6; stroke-width: 2; }
  .region[data-name="ì„œìš¸"]:hover { fill: #fff; }
  .region[data-name="ì„œìš¸"].active { fill: var(--primary-m); stroke: #fff; }

  .map-legend { display: flex; gap: 10px; margin-top: 15px; justify-content: center; font-size: 0.75rem; color: #64748b; }
  .toast { position: fixed; bottom: 30px; left: 50%; transform: translate(-50%, 20px); background: #fff; color: #000; padding: 12px 28px; border-radius: 30px; opacity:0; pointer-events:none; transition:0.3s; font-weight:700; z-index:2000; }
  .toast.on { opacity:1; transform: translate(-50%,0); }
</style>
</head>
<body>

<div class="wrap" id="captureTarget">
  <header>
    <div class="brand">
      <div class="brand-logo"></div>
      <h1>Profile <span class="ver-badge">19</span></h1>
    </div>
    <div class="btn-group" data-html2canvas-ignore>
      <button class="btn" onclick="app.randomize()">ğŸ² ëœë¤</button>
      <button class="btn btn-reset" onclick="app.reset()">â†º ì´ˆê¸°í™”</button>
      <button class="btn btn-accent" onclick="app.capture()">ğŸ“¸ ì €ì¥ (ê²°ê³¼ë§Œ)</button>
    </div>
  </header>

  <div class="panel">
    <div class="input-area" data-html2canvas-ignore>
      <div class="profile-head" style="padding: 0 30px; margin-bottom: 0;">
        <label class="avatar" style="border-color: rgba(59,130,246,0.6)">
          <input type="file" hidden accept="image/*" onchange="app.img(this,'m')">
          <img id="mImg" style="display:none"><span id="mIcon" class="avatar-icon">ğŸ‘¤</span>
        </label>
        <div class="info-box">
          <input id="mName" class="name-inp" value="ë‚˜ì˜ í”„ë¡œí•„" style="color:var(--primary-m)" oninput="app.save();app.calc()">
        </div>
      </div>
      
      <div class="input-grid">
        <!-- Category 1: ì´ì„±ì  ë§¤ë ¥ -->
        <div class="category-box">
          <div class="category-title">
            <span>ğŸ’˜ ì´ì„±ì  ë§¤ë ¥</span>
            <span id="mAttrTier" class="tier-badge">UNRANKED</span>
          </div>
          
          <!-- Row 1: Age | MBTI (Moved MBTI here) -->
          <div class="form-grid">
            <div class="form-group"><div class="lbl">ë‚˜ì´</div><input type="number" id="mAge" class="inp" value="32" oninput="app.save();app.calc()"></div>
            <div class="form-group"><div class="lbl">ì„±ê²© (MBTI)</div><select id="mMbti" class="inp" onchange="app.save();app.calc()"><option value="">ì„ íƒì•ˆí•¨</option><optgroup label="ë¶„ì„ê°€í˜•"><option value="INTJ">INTJ</option><option value="INTP">INTP</option><option value="ENTJ">ENTJ</option><option value="ENTP">ENTP</option></optgroup><optgroup label="ì™¸êµê´€í˜•"><option value="INFJ">INFJ</option><option value="INFP">INFP</option><option value="ENFJ">ENFJ</option><option value="ENFP">ENFP</option></optgroup><optgroup label="ê´€ë¦¬ìí˜•"><option value="ISTJ">ISTJ</option><option value="ISFJ" selected>ISFJ</option><option value="ESTJ">ESTJ</option><option value="ESFJ">ESFJ</option></optgroup><optgroup label="íƒí—˜ê°€í˜•"><option value="ISTP">ISTP</option><option value="ISFP">ISFP</option><option value="ESTP">ESTP</option><option value="ESFP">ESFP</option></optgroup></select></div>
          </div>

          <!-- Row 2: Height | Weight (Moved Height down, Added Weight) -->
          <div class="form-grid">
            <div class="form-group">
                <div class="lbl">í‚¤ (cm)</div>
                <!-- Max Value Restriction -->
                <input type="number" id="mHeight" class="inp" value="175" max="200" oninput="if(this.value>200)this.value=200; app.save();app.calc()">
            </div>
            <div class="form-group">
                <div class="lbl">ëª¸ë¬´ê²Œ (kg)</div>
                <!-- Weight Input (Does not trigger calc) -->
                <input type="number" id="mWeight" class="inp" value="70" oninput="app.save()">
            </div>
          </div>
          
          <!-- Row 3: Face (Slider) -->
          <div class="form-group"><div class="lbl">ì–¼êµ´ <span id="mFaceTxt" style="color:var(--primary-m)">5.0</span></div><input type="range" id="mFace" min="1" max="10" step="0.1" value="5" oninput="app.save();app.calc()"></div>
          
          <!-- Row 4: Body (Slider) - Now Full Width for better control -->
          <div class="form-group">
            <div class="lbl">ì²´í˜• <span id="mBodyTxt" style="color:var(--primary-m)">7.0</span></div>
            <input type="range" id="mBody" min="1" max="10" step="0.1" value="7" oninput="app.save();app.calc()">
          </div>
          
          <!-- Row 5: Hair | Fashion -->
          <div class="form-grid">
            <!-- í—¤ì–´ Slider -->
            <div class="form-group">
                <div class="lbl">í—¤ì–´ ìŠ¤íƒ€ì¼ <span id="mHairTxt" style="color:var(--primary-m)">7.0</span></div>
                <input type="range" id="mHair" min="1" max="10" step="0.1" value="7" oninput="app.save();app.calc()">
            </div>
            <!-- íŒ¨ì…˜ Slider -->
            <div class="form-group">
                <div class="lbl">íŒ¨ì…˜ ì„¼ìŠ¤ <span id="mFashionTxt" style="color:var(--primary-m)">7.0</span></div>
                <input type="range" id="mFashion" min="1" max="10" step="0.1" value="7" oninput="app.save();app.calc()">
            </div>
          </div>
          
          <!-- Row 6: Smoke | Tattoo -->
          <div class="form-grid">
            <div class="form-group"><div class="lbl">í¡ì—° ì—¬ë¶€</div><select id="mSmoke" class="inp" onchange="app.save();app.calc()"><option value="0" selected>ë¹„í¡ì—°</option><option value="1">í¡ì—°</option></select></div>
            <div class="form-group"><div class="lbl">ë¬¸ì‹ /íƒ€íˆ¬</div><select id="mTattoo" class="inp" onchange="app.save();app.calc()"><option value="0" selected>ì—†ìŒ</option><option value="1">ì‘ì€ ë ˆí„°ë§/ë¯¸ë‹ˆ</option><option value="2">ëˆˆì— ë„ëŠ” íƒ€íˆ¬</option><option value="3">ì „ì‹ /ì´ë ˆì¦ˆë¯¸</option></select></div>
          </div>
        </div>

        <!-- Category 2: ì‚¬íšŒì  ë§¤ë ¥ -->
        <div class="category-box">
          <div class="category-title">
            <span>ğŸ’¼ ì‚¬íšŒì  ë§¤ë ¥</span>
            <span id="mSocialTier" class="tier-badge">UNRANKED</span>
          </div>
          <div class="form-grid">
            <div class="form-group"><div class="lbl">ì—°ë´‰</div><input type="tel" id="mSal" class="inp" value="6,000" onkeyup="app.fmt(this,'mSalH');app.save();app.calc()"><div id="mSalH" class="helper"></div></div>
            <div class="form-group"><div class="lbl">ì €ì¶•</div><input type="tel" id="mSave" class="inp" value="8,000" onkeyup="app.fmt(this,'mSaveH');app.save();app.calc()"><div id="mSaveH" class="helper"></div></div>
          </div>
          
          <div class="form-grid">
            <div class="form-group">
                <div class="lbl">ë¶€ë™ì‚° ì¢…ë¥˜</div>
                <select id="mRealType" class="inp" onchange="app.save();app.calc()">
                    <option value="none">ì—†ìŒ</option>
                    <option value="apt">ì•„íŒŒíŠ¸</option>
                    <option value="officetel">ì˜¤í”¼ìŠ¤í…”</option>
                    <option value="villa">ë¹Œë¼/ì£¼íƒ</option>
                    <option value="building">ìƒê°€/ê±´ë¬¼</option>
                </select>
            </div>
            <div class="form-group">
                <div class="lbl">ë§¤ë§¤ê°€</div>
                <input type="tel" id="mReal" class="inp" value="0" onkeyup="app.fmt(this,'mRealH');app.save();app.calc()"><div id="mRealH" class="helper"></div>
            </div>
          </div>

          <div class="form-grid">
            <div class="form-group"><div class="lbl">ì§ì—…</div><select id="mJob" class="inp" onchange="app.save();app.calc()"><option value="10">ì „ë¬¸ì§</option><option value="9">ëŒ€ê¸°ì—…/IT/ê¸ˆìœµ</option><option value="8">ê³µë¬´ì›/ê³µê¸°ì—…</option><option value="7" selected>ì¤‘ê²¬/ê°•ì†Œê¸°ì—…</option><option value="5">ì¤‘ì†Œê¸°ì—…</option><option value="3">í•™ìƒ/ì¤€ë¹„ìƒ</option></select></div>
            <div class="form-group">
                <div class="lbl">í•™ë ¥</div>
                <!-- Updated Education Options -->
                <select id="mEdu" class="inp" onchange="app.save();app.calc()">
                    <option value="10">í•´ì™¸ ëª…ë¬¸ëŒ€</option>
                    <option value="9">ì„œì—°ê³ </option>
                    <option value="8">ì„œì„±í•œ</option>
                    <option value="7">ì¤‘ê²½ì™¸ì‹œ</option>
                    <option value="6">ê±´ë™í™</option>
                    <option value="5">êµ­ìˆ­ì„¸ë‹¨</option>
                    <option value="4">ê´‘ëª…ìƒê°€</option>
                    <option value="3">ê¸°íƒ€ 4ë…„ì œ</option>
                    <option value="2">ì´ˆëŒ€ì¡¸</option>
                    <option value="1">ê³ ì¡¸</option>
                </select>
            </div>
          </div>
          <div class="form-grid">
            <div class="form-group"><div class="lbl">ì°¨ëŸ‰</div><select id="mCar" class="inp" onchange="app.save();app.calc()"><option value="10">ìŠˆí¼ì¹´/í•˜ì´ì—”ë“œ</option><option value="9">ê³ ê¸‰ ì™¸ì œì°¨</option><option value="8">ê³ ê¸‰ êµ­ì‚°ì°¨</option><option value="6" selected>ì¼ë°˜ ìŠ¹ìš©ì°¨</option><option value="4">ì°¨ëŸ‰ ì—†ìŒ</option></select></div>
            <div class="form-group"><div class="lbl">ê±°ì£¼ ì§€ì—­</div><button id="mLocBtn" class="inp map-btn" onclick="mapModal.open('m')">ì„œìš¸</button><input type="hidden" id="mLoc" value="ì„œìš¸"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="analysis-sec">
      <!-- TWO CHARTS -->
      <div class="charts-wrapper">
        <div class="chart-box">
          <canvas id="attrCanvas"></canvas>
          <div class="chart-label">ğŸ’˜ ì´ì„±ì  ë§¤ë ¥ ì§€í‘œ</div>
        </div>
        <div class="chart-box">
          <canvas id="socialCanvas"></canvas>
          <div class="chart-label">ğŸ’¼ ì‚¬íšŒì  ë§¤ë ¥ ì§€í‘œ</div>
        </div>
      </div>
      
      <div id="report" class="report-card"></div>
    </div>
  </div>
</div>

<!-- Modal & Toast (Same) -->
<div id="mapModal" class="modal-overlay">
  <div class="map-card">
    <div class="map-head"><div class="map-title">ğŸ“ ì§€ì—­ ì„ íƒ</div><button class="close-btn" onclick="mapModal.close()">Ã—</button></div>
    <input type="text" id="mapSearch" class="map-search" placeholder="ì§€ì—­ ê²€ìƒ‰ (ì˜ˆ: ë¶€ì‚°, ê°•ì›...)" oninput="mapModal.search(this.value)">
    <svg class="korea-map" viewBox="0 0 400 550" xmlns="http://www.w3.org/2000/svg">
      <defs><filter id="glow" x="-20%" y="-20%" width="140%" height="140%"><feGaussianBlur stdDeviation="3" result="blur" /><feComposite in="SourceGraphic" in2="blur" operator="over" /></filter></defs>
      <g id="mapGroup">
        <path class="region" data-name="ê°•ì›" d="M175,60 L230,45 L260,130 L250,165 L210,170 L170,140 L160,110 Z" onclick="mapModal.select('ê°•ì›')"></path><text x="215" y="110" class="region-text">ê°•ì›</text>
        <path class="region" data-name="ê²½ê¸°" d="M120,90 L175,60 L160,110 L170,140 L160,175 L100,165 L90,120 Z" onclick="mapModal.select('ê²½ê¸°')"></path><text x="125" y="115" class="region-text">ê²½ê¸°/ì¸ì²œ</text>
        <path class="region" data-name="ì„œìš¸" d="M135,120 L155,120 L160,135 L140,140 Z" onclick="mapModal.select('ì„œìš¸')"></path><circle cx="148" cy="130" r="2" fill="none" style="pointer-events:none"></circle><text x="148" y="134" class="region-text" style="font-size:10px; fill:#333;">ì„œìš¸</text>
        <path class="region" data-name="ì¶©ì²­" d="M100,165 L160,175 L210,170 L205,220 L130,230 L90,190 Z" onclick="mapModal.select('ì¶©ì²­')"></path><text x="150" y="205" class="region-text">ì¶©ì²­/ëŒ€ì „</text>
        <path class="region" data-name="ê²½ìƒ" d="M210,170 L250,165 L260,130 L275,250 L210,270 L195,230 L205,220 Z" onclick="mapModal.select('ê²½ìƒ')"></path><text x="235" y="220" class="region-text">ê²½ìƒ/ë¶€ì‚°</text>
        <path class="region" data-name="ì „ë¼" d="M130,230 L205,220 L195,230 L185,300 L110,290 L100,240 Z" onclick="mapModal.select('ì „ë¼')"></path><text x="150" y="265" class="region-text">ì „ë¼/ê´‘ì£¼</text>
        <path class="region" data-name="ì œì£¼" d="M120,360 L180,355 L175,385 L130,385 Z" onclick="mapModal.select('ì œì£¼')"></path><text x="152" y="378" class="region-text">ì œì£¼</text>
        <g class="region" data-name="í•´ì™¸" onclick="mapModal.select('í•´ì™¸')"><circle cx="340" cy="480" r="30" style="fill:#1e293b; stroke:#64748b; stroke-dasharray: 4 2; stroke-width:1"></circle><text x="340" y="485" fill="#94a3b8" font-size="20" text-anchor="middle" style="pointer-events:none">âœˆï¸</text></g><text x="340" y="530" class="region-text">í•´ì™¸</text>
      </g>
    </svg>
    <div class="map-legend">ğŸ‘† ì§€ì—­ì„ ì„ íƒí•˜ì—¬ ì…ë ¥í•˜ì„¸ìš”</div>
  </div>
</div>
<div id="toast" class="toast"><span>ğŸ’¾</span> <span id="toastMsg">ì €ì¥ ì™„ë£Œ!</span></div>

<script>
const $ = id => document.getElementById(id);
const LABELS_ATTR = ['ë‚˜ì´', 'í‚¤', 'ì–¼êµ´', 'ì²´í˜•', 'í—¤ì–´', 'íŒ¨ì…˜'];
const LABELS_SOCIAL = ['ì†Œë“', 'ì €ì¶•', 'ë¶€ë™ì‚°', 'í•™ë ¥', 'ì§ì—…', 'ì°¨ëŸ‰'];
const LOC_ZONES = ['ì„œìš¸','ê²½ê¸°','ê°•ì›','ì¶©ì²­','ì „ë¼','ê²½ìƒ','ì œì£¼','í•´ì™¸'];

const getTierByAvg = (avg) => {
    let tName='BRONZE', tColor='#ad8b73'; 
    if(avg >= 9.0) { tName='MASTER'; tColor='#ef4444'; }
    else if(avg >= 8.0) { tName='DIAMOND'; tColor='#3b82f6'; }
    else if(avg >= 7.0) { tName='PLATINUM'; tColor='#10b981'; }
    else if(avg >= 6.0) { tName='GOLD'; tColor='#f59e0b'; }
    else if(avg >= 5.0) { tName='SILVER'; tColor='#cbd5e1'; }
    return { tName, tColor };
};

const mapModal = {
  target: null, el: $('mapModal'),
  open(t) { this.target = t; this.el.classList.add('active'); $('mapSearch').value = ''; $('mapSearch').focus(); this.highlight($(t+'Loc').value); },
  close() { this.el.classList.remove('active'); },
  select(loc) { if(!this.target) return; const t = this.target; $(t+'Loc').value = loc; $(t+'LocBtn').innerText = loc; app.save(); app.calc(); this.close(); },
  search(keyword) {
    if(!keyword) { this.clearHighlight(); return; }
    const map = { 'ì„œìš¸':'ì„œìš¸','ê°•ë‚¨':'ì„œìš¸','í™ëŒ€':'ì„œìš¸', 'ê²½ê¸°':'ê²½ê¸°','ì¸ì²œ':'ê²½ê¸°','ìˆ˜ì›':'ê²½ê¸°','ë¶„ë‹¹':'ê²½ê¸°','ì¼ì‚°':'ê²½ê¸°', 'ë¶€ì‚°':'ê²½ìƒ','ëŒ€êµ¬':'ê²½ìƒ','ìš¸ì‚°':'ê²½ìƒ','ì°½ì›':'ê²½ìƒ','ê²½ë¶':'ê²½ìƒ','ê²½ë‚¨':'ê²½ìƒ', 'ê´‘ì£¼':'ì „ë¼','ì „ì£¼':'ì „ë¼','ì „ë‚¨':'ì „ë¼','ì „ë¶':'ì „ë¼', 'ëŒ€ì „':'ì¶©ì²­','ì„¸ì¢…':'ì¶©ì²­','ì¶©ë‚¨':'ì¶©ì²­','ì¶©ë¶':'ì¶©ì²­','ì²­ì£¼':'ì¶©ì²­','ì²œì•ˆ':'ì¶©ì²­', 'ê°•ì›':'ê°•ì›','ì†ì´ˆ':'ê°•ì›','ê°•ë¦‰':'ê°•ì›', 'ì œì£¼':'ì œì£¼', 'ë¯¸êµ­':'í•´ì™¸','ì¼ë³¸':'í•´ì™¸' };
    let found = null; for(const k in map) { if(k.includes(keyword) || keyword.includes(k)) { found = map[k]; break; } }
    if(found) this.highlight(found); else this.clearHighlight();
  },
  highlight(locName) { document.querySelectorAll('.region').forEach(el => { const name = el.dataset.name || el.parentElement.dataset.name; if(name === locName) el.classList.add('active'); else el.classList.remove('active'); }); },
  clearHighlight() { document.querySelectorAll('.region').forEach(el => el.classList.remove('active')); }
};

const app = {
  d: { m:{} },
  ani: { attr: [0,0,0,0,0,0], social: [0,0,0,0,0,0], score: 0 },
  chartCoords: { attr: [], social: [] },
  hoverState: null,
  targetScore: 0,
  
  init() {
    this.load();
    window.addEventListener('resize', ()=>this.draw());
    this.setupHover();
    this.calc();
    this.loop();
  },

  setupHover() {
    ['attrCanvas', 'socialCanvas'].forEach(id => {
        const el = $(id);
        const type = id === 'attrCanvas' ? 'attr' : 'social';
        el.addEventListener('mousemove', e => {
            const rect = el.getBoundingClientRect();
            const x = (e.clientX - rect.left);
            const y = (e.clientY - rect.top);
            let found = null;
            const points = this.chartCoords[type];
            if (points) {
                for (let i = 0; i < points.length; i++) {
                    const p = points[i];
                    const dist = Math.sqrt((x - p.x)**2 + (y - p.y)**2);
                    if (dist < 20) { found = { ...p, type }; break; }
                }
            }
            this.hoverState = found;
        });
        el.addEventListener('mouseleave', () => { this.hoverState = null; });
    });
  },

  save() {
    // Added 'mWeight' to the saved ID list
    const ids = ['mName','mAge','mHeight','mWeight','mMbti','mLoc','mSmoke','mEdu','mSal','mSave','mReal','mRealType','mFace', 'mHair', 'mFashion', 'mBody', 'mJob', 'mCar', 'mTattoo'];
    const data = {};
    ids.forEach(id => { if($(id)) data[id] = $(id).value; });
    localStorage.setItem('hexa_v19_map_data_m_solo_v12', JSON.stringify(data));
  },
  
  load() {
    const data = JSON.parse(localStorage.getItem('hexa_v19_map_data_m_solo_v12'));
    if(data) { for(const id in data) { if($(id)) { $(id).value = data[id]; if(id.includes('Loc') && !id.includes('Btn')) $(id+'Btn').innerText = data[id]; } } }
    this.fmt($('mSal'), 'mSalH'); this.fmt($('mSave'), 'mSaveH'); this.fmt($('mReal'), 'mRealH');
  },

  getStats(t) {
    const age = Number($(t+'Age').value) || 30;
    const h = Number($(t+'Height').value) || 170;
    // Weight is read but unused in scoring as requested
    const w = Number($(t+'Weight').value) || 70;

    const face = Number($(t+'Face').value);
    const body = Number($(t+'Body').value) || 7; 
    const hair = Number($(t+'Hair').value) || 7; 
    const fashion = Number($(t+'Fashion').value) || 7; 
    
    const edu = Number($(t+'Edu').value);
    const sal = Number($(t+'Sal').value.replace(/,/g,''));
    const save = Number($(t+'Save').value.replace(/,/g,''));
    const real = Number($(t+'Real').value.replace(/,/g,''));
    
    const job = Number($(t+'Job').value) || 7;
    const car = Number($(t+'Car').value) || 6;
    const loc = $(t+'Loc').value;
    const smoke = Number($(t+'Smoke').value);
    const tattoo = Number($(t+'Tattoo').value);
    const mbti = $(t+'Mbti').value;

    // Update Slider Display Text
    $(t+'FaceTxt').innerText = face.toFixed(1);
    $(t+'BodyTxt').innerText = body.toFixed(1);
    $(t+'HairTxt').innerText = hair.toFixed(1);
    $(t+'FashionTxt').innerText = fashion.toFixed(1);

    let sAge = 5;
    if (age >= 20 && age <= 35) { sAge = 10; } 
    else {
        const diff = age > 35 ? age - 35 : (age < 20 ? 20 - age : 0);
        sAge = Math.max(2, 10 - diff * 0.5);
    }
    
    let sHeight = 5;
    sHeight = h<165? 3 : h>185? 10 : 3+((h-165)/20)*7; 
    
    const getLogScore = (v, min, max) => v<min ? 2 : Math.min(10, Math.max(2, 2 + ((Math.log(v)-Math.log(min))/(Math.log(max)-Math.log(min)))*8));
    const sSal = getLogScore(sal, 4000, 20000); 
    const sSave = getLogScore(save, 1000, 30000); 
    const sReal = getLogScore(real, 5000, 300000);
    
    const attrData = [sAge, sHeight, face, body, hair, fashion];
    const socialData = [sSal, sSave, sReal, edu, job, car];

    return { attrData, socialData, age, h, w, face, body, hair, fashion, edu, sal, save, real, job, car, loc, smoke, tattoo, mbti };
  },

  calc() {
    const M = this.getStats('m');
    this.d = { m:M };

    const attrAvg = M.attrData.reduce((a,b)=>a+b,0) / 6;
    const socialAvg = M.socialData.reduce((a,b)=>a+b,0) / 6; 
    
    const attrTier = getTierByAvg(attrAvg);
    const socialTier = getTierByAvg(socialAvg);
    
    const totalAvg = (attrAvg + socialAvg) / 2;
    const { tName: rank, tColor } = getTierByAvg(totalAvg);

    this.targetScore = Math.min(100, Math.round(totalAvg * 10));

    const updateTierBadge = (id, tierObj) => {
      const el = $(id);
      if(el) {
        el.innerText = tierObj.tName;
        el.style.color = tierObj.tColor;
        el.style.borderColor = tierObj.tColor;
      }
    };
    updateTierBadge('mAttrTier', attrTier);
    updateTierBadge('mSocialTier', socialTier);

    const pros=[], cons=[];
    if(M.face >= 8 && M.body >= 7) pros.push("ë¹„ì£¼ì–¼ ê²½ìŸë ¥ ë†’ìŒ");
    if(M.sal >= 10000 || M.save >= 10000) pros.push("ğŸ’° ì•ˆì •ì ì¸ ê²½ì œë ¥");
    if(M.real > 50000) pros.push("ğŸ¢ ìê°€/ë¶€ë™ì‚° ë³´ìœ ");
    if(M.job >= 9) pros.push("ğŸ† ì‚¬íšŒì  ì§€ìœ„ ë†’ìŒ");
    
    if(M.face <= 4) cons.push("âš ï¸ ì–¼êµ´ ë³´ì™„ í•„ìš”");
    if(M.job <= 4) cons.push("âš ï¸ ì§ì—… ì•ˆì •ì„± ë³´ì™„ í•„ìš”");
    if(M.h >= 180) pros.push("í›¤ì¹ í•œ í‚¤");
    
    if(M.tattoo === 0) pros.push("ë¬¸ì‹  ì—†ìŒ (Clean)");
    else if(M.tattoo === 1) pros.push("íŒ¨ì…˜ íƒ€íˆ¬ (Style)");
    else if(M.tattoo >= 2) cons.push("íƒ€íˆ¬ ë³´ìœ  (í˜¸ë¶ˆí˜¸ ìš”ì†Œ)");
    
    const life = this.predictLifestyle({ ...M, tName: rank });
    const safeJoin = arr => arr.length ? arr.map(t=>`<span class="tag">${t}</span>`).join(' ') : '<span style="opacity:0.5;font-size:0.8rem">íŠ¹ì´ì‚¬í•­ ì—†ìŒ</span>';

    $('report').innerHTML = `
      <div class="score-badge" style="color:var(--primary-m)">TOTAL PROFILE STATUS</div>
      <div class="score-big">${this.targetScore}<span class="score-rank">${rank}</span></div>
      <div class="breakdown-box">
        <div class="bd-row">
          <div style="width:100px; color:#f43f5e">ì´ì„±ì  ë§¤ë ¥</div>
          <div class="bd-track"><div class="bd-bar" style="width:${attrAvg/10*100}%; background:#f43f5e"></div></div>
          <div style="font-weight:800; color:${attrTier.tColor}; width:80px; text-align:right;">${attrTier.tName}</div> 
          <div style="width:40px; text-align:right;">${attrAvg.toFixed(1)}</div>
        </div>
        <div class="bd-row">
          <div style="width:100px; color:#10b981">ì‚¬íšŒì  ë§¤ë ¥</div>
          <div class="bd-track"><div class="bd-bar" style="width:${socialAvg/10*100}%; background:#10b981"></div></div>
          <div style="font-weight:800; color:${socialTier.tColor}; width:80px; text-align:right;">${socialTier.tName}</div>
          <div style="width:40px; text-align:right;">${socialAvg.toFixed(1)}</div>
        </div>
        <div class="bd-row" style="margin-top:10px; padding-top:10px; border-top:1px solid rgba(255,255,255,0.1)">
          <div style="width:100px; color:${tColor}; font-weight:800;">ì¢…í•© ë“±ê¸‰</div>
          <div class="bd-track"><div class="bd-bar" style="width:${totalAvg/10*100}%; background:${tColor}"></div></div>
          <div style="font-weight:900; color:${tColor}; width:80px; text-align:right;">${rank}</div>
          <div style="width:40px; text-align:right;">${totalAvg.toFixed(1)}</div>
        </div>
      </div>
      <div class="lifestyle-box">
        <div style="font-weight:800;color:#60a5fa;margin-bottom:8px">â­ AI ì ì¬ë ¥ ë¶„ì„</div>
        <div style="font-size:0.95rem;line-height:1.5"><b>"${rank}" ë“±ê¸‰ì˜ ì ì¬ë ¥</b><br>${life.career}<br>${life.goal}</div>
      </div>
      <div class="detail-grid">
        <div class="detail-item" style="border-top:3px solid var(--primary-m)"><div class="lbl">ğŸ‘ ê°•ì  (Strengths)</div><div>${safeJoin(pros)}</div></div>
        <div class="detail-item" style="border-top:3px solid var(--danger)"><div class="lbl">âš ï¸ ë³´ì™„ì  (Improvement)</div><div>${safeJoin(cons)}</div></div>
      </div>
    `;

    if (this.targetScore >= 85 && Math.abs(this.ani.score - this.targetScore) > 20) confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
  },

  predictLifestyle(m) {
    let career = "ì•ˆì •ì ì¸ ì§ì¥ê³¼ ì»¤ë¦¬ì–´ë¥¼ ì§€í–¥í•©ë‹ˆë‹¤.";
    let goal = "í•©ë¦¬ì ì¸ ì†Œë¹„ì™€ ê¾¸ì¤€í•œ ì¬í…Œí¬ë¥¼ í†µí•´ ê¸°ë°˜ì„ ë‹¤ì§€ëŠ” ìŠ¤íƒ€ì¼ì…ë‹ˆë‹¤.";
    if(m.job >= 9 && m.sal >= 10000) { career = "ìµœìƒìœ„ ì „ë¬¸ì§/ë¦¬ë” ê·¸ë£¹ì— ì†í•©ë‹ˆë‹¤."; goal = "ê²½ì œì  ììœ ì™€ ì‚¬íšŒì  ëª…ì˜ˆë¥¼ ëª¨ë‘ ê±°ë¨¸ì¥˜ ìˆ˜ ìˆìŠµë‹ˆë‹¤."; }
    else if(m.car >= 9 && m.face >= 8) { career = "í™”ë ¤í•œ ë¼ì´í”„ìŠ¤íƒ€ì¼ì„ ì¦ê¸°ëŠ” íŠ¸ë Œë“œ ì„¸í„°ì…ë‹ˆë‹¤."; } 
    return { career, goal };
  },

  loop() {
    const diff = this.targetScore - this.ani.score;
    if(Math.abs(diff) > 0.1) {
      this.ani.score += diff * 0.1;
      const el = document.querySelector('.score-big');
      if(el) {
         const avgScore = this.ani.score / 10;
         const { tName: rank } = getTierByAvg(avgScore);
         el.innerHTML = Math.round(this.ani.score) + `<span class="score-rank">${rank}</span>`;
      }
    }
    for(let i=0; i<6; i++) { this.ani.attr[i] += (this.d.m.attrData[i] - this.ani.attr[i]) * 0.15; }
    for(let i=0; i<6; i++) { this.ani.social[i] += (this.d.m.socialData[i] - this.ani.social[i]) * 0.15; }
    this.draw();
    requestAnimationFrame(()=>this.loop());
  },

  draw() {
    this.drawChart('attrCanvas', this.ani.attr, this.d.m.attrData, LABELS_ATTR, '#f43f5e', 'rgba(244, 63, 94, 0.15)', 'attr');
    this.drawChart('socialCanvas', this.ani.social, this.d.m.socialData, LABELS_SOCIAL, '#10b981', 'rgba(16, 185, 129, 0.15)', 'social');
  },

  drawChart(canvasId, data, realData, labels, color, bg, type) {
    const cvs = $(canvasId);
    if(!cvs) return;
    const ctx = cvs.getContext('2d');
    const box = cvs.parentElement.getBoundingClientRect();
    const size = box.width; 
    const dpr = window.devicePixelRatio || 1;
    
    if(cvs.width !== size*dpr) { cvs.width = size*dpr; cvs.height = size*dpr; ctx.scale(dpr,dpr); }
    
    const cx = size/2, cy = size/2, r = size*0.35;
    const sides = labels.length;
    
    ctx.clearRect(0,0,size,size);

    ctx.strokeStyle = 'rgba(255,255,255,0.08)'; ctx.lineWidth = 1;
    [0.2, 0.4, 0.6, 0.8, 1].forEach(sc => {
      ctx.beginPath();
      for(let j=0; j<sides; j++) {
        const ang = (Math.PI*2*j)/sides - Math.PI/2;
        ctx[j==0?'moveTo':'lineTo'](cx+Math.cos(ang)*r*sc, cy+Math.sin(ang)*r*sc);
      }
      ctx.closePath(); ctx.stroke();
    });

    const currentCoords = [];

    ctx.beginPath();
    data.forEach((v, i) => {
      const ang = (Math.PI*2*i)/sides - Math.PI/2;
      const rad = r*(Math.max(1,Math.min(10,v))/10);
      const px = cx + Math.cos(ang)*rad;
      const py = cy + Math.sin(ang)*rad;
      
      if(i===0) ctx.moveTo(px, py); else ctx.lineTo(px, py);
      currentCoords.push({ x: px, y: py, val: realData[i], label: labels[i] });
    });
    ctx.closePath(); ctx.fillStyle = bg; ctx.fill(); ctx.strokeStyle = color; ctx.lineWidth = 2.5; ctx.stroke();

    ctx.fillStyle = '#94a3b8'; ctx.font = `700 ${Math.max(11, size*0.045)}px var(--font-stack)`;
    ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
    labels.forEach((l,i) => {
      const ang = (Math.PI*2*i)/sides - Math.PI/2;
      const pad = 20;
      ctx.fillText(l, cx+Math.cos(ang)*(r+pad), cy+Math.sin(ang)*(r+pad));
    });
    
    this.chartCoords[type] = currentCoords;

    if(this.hoverState && this.hoverState.type === type) {
        const h = this.hoverState;
        ctx.beginPath();
        ctx.arc(h.x, h.y, 6, 0, Math.PI*2);
        ctx.fillStyle = '#fff';
        ctx.fill();
        ctx.strokeStyle = color;
        ctx.lineWidth = 2;
        ctx.stroke();
        
        const text = `${h.label}: ${typeof h.val === 'number' ? h.val.toFixed(1) : h.val}`;
        const tw = ctx.measureText(text).width + 20;
        const th = 26;
        const tx = h.x - tw/2;
        const ty = h.y - 35;
        
        ctx.fillStyle = 'rgba(15, 23, 42, 0.9)';
        ctx.beginPath();
        ctx.roundRect(tx, ty, tw, th, 6);
        ctx.fill();
        ctx.strokeStyle = 'rgba(255,255,255,0.2)';
        ctx.lineWidth = 1;
        ctx.stroke();
        
        ctx.fillStyle = '#fff';
        ctx.font = `600 12px var(--font-stack)`;
        ctx.fillText(text, h.x, ty + th/2);
    }
  },

  randomize() {
    const r = (min,max) => Math.floor(Math.random()*(max-min+1))+min;
    const t = 'm';
    $(t+'Age').value = r(28,38); $(t+'Height').value = r(170,188);
    // Added Weight randomization (just simple range)
    $(t+'Weight').value = r(60, 95);

    $(t+'Edu').value = r(4, 9); 
    $(t+'Sal').value = r(4500, 12000).toLocaleString();
    $(t+'Save').value = r(3000, 10000).toLocaleString(); 
    $(t+'RealType').value = ['none','apt','officetel','villa'][r(0,3)];
    $(t+'Real').value = $(t+'RealType').value === 'none' ? 0 : r(5000, 100000).toLocaleString();
    
    // Updated Randomize for Sliders (1.0 - 10.0)
    $(t+'Face').value = (r(50,100)/10).toFixed(1);
    $(t+'Body').value = (r(40,90)/10).toFixed(1);
    $(t+'Hair').value = (r(40,90)/10).toFixed(1);
    $(t+'Fashion').value = (r(40,90)/10).toFixed(1);

    $(t+'Smoke').value = Math.random()>0.8 ? 1 : 0;
    $(t+'Tattoo').value = r(0, 3);
    $(t+'Job').value = r(5, 10); $(t+'Car').value = r(4, 10);
    const rc = LOC_ZONES[r(0, LOC_ZONES.length-1)]; $(t+'Loc').value = rc; $(t+'LocBtn').innerText = rc;
    this.fmt($(t+'Sal'), t+'SalH'); this.fmt($(t+'Save'), t+'SaveH'); this.fmt($(t+'Real'), t+'RealH');
    this.save(); this.calc(); this.toast('ğŸ² ëœë¤ ìƒì„±');
  },

  reset() {
    const t = 'm';
    $(t+'Name').value = 'ë‚˜ì˜ í”„ë¡œí•„'; $(t+'Age').value = 32; $(t+'Height').value = 175;
    // Added Weight reset
    $(t+'Weight').value = 70;

    $(t+'Sal').value = 6000; $(t+'Save').value = 8000; $(t+'Real').value = 0; $(t+'RealType').value = 'none';
    $(t+'Mbti').value = 'ISFJ'; $(t+'Smoke').value = 0; $(t+'Tattoo').value = 0;
    $(t+'Edu').value = 6; $(t+'Job').value = 7; $(t+'Car').value = 6;
    
    // Reset Sliders to defaults
    $(t+'Face').value = 5.0; 
    $(t+'Body').value = 7.0; 
    $(t+'Hair').value = 7.0; 
    $(t+'Fashion').value = 7.0;

    $(t+'Loc').value = 'ì„œìš¸'; $(t+'LocBtn').innerText = 'ì„œìš¸';
    $(t+'SalH').classList.remove('show'); $(t+'SaveH').classList.remove('show'); $(t+'RealH').classList.remove('show');
    localStorage.removeItem('hexa_v19_map_data_m_solo_v12');
    this.calc(); this.toast('â†º ì´ˆê¸°í™”');
  },

  fmt(el, hId) {
    let v = el.value.replace(/[^0-9]/g,'');
    if(!v) { $(hId).classList.remove('show'); return; }
    el.value = Number(v).toLocaleString();
    const n = Number(v);
    const uk = Math.floor(n/10000); const man = n%10000;
    $(hId).innerText = (uk ? `${uk}ì–µ ` : '') + (man ? `${man.toLocaleString()}ë§Œ` : '') + 'ì›';
    $(hId).classList.add('show');
  },
  
  img(inp, t) {
    if(inp.files[0]) {
      const rd = new FileReader();
      rd.onload = e => { $(t+'Img').src = e.target.result; $(t+'Img').style.display='block'; $(t+'Icon').style.display='none'; };
      rd.readAsDataURL(inp.files[0]);
    }
  },
  
  capture() {
    window.scrollTo(0,0);
    const btn = event.target; btn.innerHTML = 'â³ ì²˜ë¦¬ì¤‘...';
    // Fixed typo: querySeflector -> querySelector
    html2canvas($('captureTarget').querySelector('.panel'), { backgroundColor: "#0f172a", scale: 2, ignoreElements: el => el.hasAttribute('data-html2canvas-ignore') }).then(cvs => {
      const a = document.createElement('a'); a.download = `Profile_Report_${Date.now()}.png`;
      a.href = cvs.toDataURL(); a.click(); btn.innerHTML = 'ğŸ“¸ ì €ì¥ (ê²°ê³¼ë§Œ)';
      this.toast('ì´ë¯¸ì§€ ì €ì¥ ì™„ë£Œ'); confetti({ particleCount: 150, spread: 60 });
    });
  },
  
  toast(msg) {
    const t = $('toast'); $('toastMsg').innerText = msg; t.classList.add('on');
    clearTimeout(this.tm); this.tm = setTimeout(()=>t.classList.remove('on'), 2000);
  }
};

app.init();
</script>
</body>
</html>


