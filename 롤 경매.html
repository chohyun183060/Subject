<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¡¤ ë©¸ë§ì „ ê²½ë§¤ ì‹œìŠ¤í…œ (ê¸°ë¡ì‹¤ ì¶”ê°€)</title>
    <!-- Tailwind CSS (ë””ìì¸) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM (ë¡œì§) -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <!-- Babel (JSX ë³€í™˜) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body { font-family: 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif; }
        /* ìŠ¤í¬ë¡¤ë°” ì»¤ìŠ¤í…€ */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
        
        .fade-in { animation: fadeIn 0.2s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .list-item-move { transition: all 0.5s ease; }
    </style>
</head>
<body class="bg-slate-950 text-white">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- ì•„ì´ì½˜ ì»´í¬ë„ŒíŠ¸ ---
        const Icon = ({ children, className, onClick }) => (
            <svg onClick={onClick} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );
        const Trophy = (props) => <Icon {...props}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></Icon>;
        const Users = (props) => <Icon {...props}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></Icon>;
        const Gavel = (props) => <Icon {...props}><path d="m14.5 12.5-8 8a2.121 2.121 0 0 1-3-3l8-8"/><path d="m16 16 6-6"/><path d="m8 8 6-6"/><path d="m9 7 8 8"/><path d="m21 11-8-8"/></Icon>;
        const ArrowRight = (props) => <Icon {...props}><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></Icon>;
        const Home = (props) => <Icon {...props}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></Icon>;
        const AlertCircle = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></Icon>;
        const MinusCircle = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/></Icon>;
        const RotateCcw = (props) => <Icon {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></Icon>;
        const ListIcon = (props) => <Icon {...props}><line x1="8" x2="21" y1="6" y2="6"/><line x1="8" x2="21" y1="12" y2="12"/><line x1="8" x2="21" y1="18" y2="18"/><line x1="3" x2="3.01" y1="6" y2="6"/><line x1="3" x2="3.01" y1="12" y2="12"/><line x1="3" x2="3.01" y1="18" y2="18"/></Icon>;
        const CopyIcon = (props) => <Icon {...props}><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></Icon>;
        const UndoIcon = (props) => <Icon {...props}><path d="M3 7v6h6"/><path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"/></Icon>;
        const Crown = (props) => <Icon {...props}><path d="m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14"/></Icon>;
        const SaveIcon = (props) => <Icon {...props}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></Icon>;
        const RefreshIcon = (props) => <Icon {...props}><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 21h5v-5"/></Icon>;
        const CloudUpload = (props) => <Icon {...props}><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/><path d="M12 12v9"/><path d="m16 16-4-4-4 4"/></Icon>;
        const CloudDownload = (props) => <Icon {...props}><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/><path d="M12 12v9"/><path d="m8 17 4 4 4-4"/></Icon>;
        const XIcon = (props) => <Icon {...props}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></Icon>;
        const FileText = (props) => <Icon {...props}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></Icon>;
        const Plus = (props) => <Icon {...props}><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></Icon>;
        const Trash2 = (props) => <Icon {...props}><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></Icon>;
        const HistoryIcon = (props) => <Icon {...props}><path d="M3 3v5h5"/><path d="M3.05 13A9 9 0 1 0 6 5.3L3 8"/><path d="M12 7v5l4 2"/></Icon>;

        // --- ë°ì´í„° ì •ì˜ ---
        const ROLES = ['TOP', 'JGL', 'MID', 'ADC', 'SUP'];
        const TIERS = ['SSS', 'SS', 'S', 'A', 'B', 'C', 'D'];
        const TIER_SCORES = { SSS: 7, SS: 6, S: 5, A: 4, B: 3, C: 2, D: 1 };

        const TIER_COLORS = {
            SSS: 'text-rose-500 drop-shadow-[0_0_5px_rgba(244,63,94,0.5)]',
            SS: 'text-purple-400',
            S: 'text-blue-400',
            A: 'text-emerald-400',
            B: 'text-yellow-400',
            C: 'text-slate-400',
            D: 'text-amber-700',
        };

        const INITIAL_PLAYERS = [
            { name: 'í˜„íƒœ', role: 'TOP', tier: 'S', isCaptain: true },
            { name: 'ê±´ì¬', role: 'TOP', tier: 'A', isCaptain: false },
            { name: 'íƒœë¬´', role: 'TOP', tier: 'B', isCaptain: false },
            { name: 'ìŠ¹ë²”', role: 'TOP', tier: 'C', isCaptain: false },
            { name: 'ì¸í˜', role: 'JGL', tier: 'SSS', isCaptain: true },
            { name: 'ì„ ìš°', role: 'JGL', tier: 'SS', isCaptain: false },
            { name: 'ì§„í˜„', role: 'JGL', tier: 'A', isCaptain: false },
            { name: 'í˜¸ì—°', role: 'JGL', tier: 'C', isCaptain: false },
            { name: 'ì£¼í˜¸', role: 'MID', tier: 'S', isCaptain: false },
            { name: 'ì°¬í˜„', role: 'MID', tier: 'A', isCaptain: false },
            { name: 'í˜¸ì§„', role: 'MID', tier: 'B', isCaptain: false },
            { name: 'ìŠ¹ì›', role: 'MID', tier: 'B', isCaptain: false },
            { name: 'í¬ì„±', role: 'ADC', tier: 'SS', isCaptain: true },
            { name: 'ì„±ìœ¤', role: 'ADC', tier: 'A', isCaptain: false },
            { name: 'í˜„ë¹ˆ', role: 'ADC', tier: 'B', isCaptain: false },
            { name: 'ì„¸ì—°', role: 'ADC', tier: 'B', isCaptain: false },
            { name: 'í¬ì² ', role: 'SUP', tier: 'S', isCaptain: true },
            { name: 'ì¼ì„œ', role: 'SUP', tier: 'B', isCaptain: false },
            { name: 'í•„ë¦½', role: 'SUP', tier: 'C', isCaptain: false },
            { name: 'ê´€ìš°', role: 'SUP', tier: 'D', isCaptain: false },
        ];

        const calculateTeamStats = (teamMembers, allPlayers) => {
            if (teamMembers.length === 0) return { max: '-', min: '-', avg: '-' };
            const scores = teamMembers.map(member => {
                const player = allPlayers.find(p => p.name === member.name);
                return player ? TIER_SCORES[player.tier] : 0;
            });
            const maxScore = Math.max(...scores);
            const minScore = Math.min(...scores);
            const avgScore = scores.reduce((a, b) => a + b, 0) / scores.length;
            const getTierName = (score) => Object.keys(TIER_SCORES).find(key => TIER_SCORES[key] === score) || '?';
            return { max: getTierName(maxScore), min: getTierName(minScore), avg: avgScore.toFixed(1) };
        };

        // --- ë©”ì¸ ì•± ì»´í¬ë„ŒíŠ¸ ---
        function LoLAuctionApp() {
            const [view, setView] = useState('setup');
            
            const initializePlayers = (rawPlayers) => rawPlayers.map((p, i) => ({
                ...p, id: p.id || `p_${Date.now()}_${i}`,
                lolNick: p.lolNick || '', rankTier: p.rankTier || '',
                sig1: p.sig1 || '', sig2: p.sig2 || '', sig3: p.sig3 || '',
                champPool: p.champPool || '', laningPros: p.laningPros || '',
                laningCons: p.laningCons || '', teamfightPros: p.teamfightPros || '', teamfightCons: p.teamfightCons || ''
            }));

            const [players, setPlayers] = useState(() => {
                const saved = localStorage.getItem('lol_auction_players_v2');
                return saved ? initializePlayers(JSON.parse(saved)) : initializePlayers(INITIAL_PLAYERS);
            });
            
            const [initialPoints, setInitialPoints] = useState(() => {
                const saved = localStorage.getItem('lol_auction_points_v2');
                if (saved) return JSON.parse(saved);
                const points = {};
                INITIAL_PLAYERS.forEach(p => { points[p.name] = 1000; });
                return points;
            });

            // ê¸°ë¡ì‹¤ ë°ì´í„°
            const [savedHistories, setSavedHistories] = useState(() => {
                const saved = localStorage.getItem('lol_auction_histories');
                return saved ? JSON.parse(saved) : [];
            });

            useEffect(() => {
                localStorage.setItem('lol_auction_players_v2', JSON.stringify(players));
                localStorage.setItem('lol_auction_points_v2', JSON.stringify(initialPoints));
            }, [players, initialPoints]);

            useEffect(() => {
                localStorage.setItem('lol_auction_histories', JSON.stringify(savedHistories));
            }, [savedHistories]);

            const selectedCaptains = useMemo(() => players.filter(p => p.isCaptain).map(p => p.name), [players]);

            const [teams, setTeams] = useState([]);
            const [auctionQueue, setAuctionQueue] = useState([]);
            const [currentBid, setCurrentBid] = useState(null);
            const [unsoldList, setUnsoldList] = useState([]);
            const [bidPrice, setBidPrice] = useState('');
            const [errorMsg, setErrorMsg] = useState('');
            const [copyMsg, setCopyMsg] = useState('');
            const [history, setHistory] = useState([]);
            const [activeModal, setActiveModal] = useState(null);
            const [modalInputValue, setModalInputValue] = useState('');
            const [modalMessage, setModalMessage] = useState('');
            
            const [editingPlayer, setEditingPlayer] = useState(null);
            const [targetPlayerId, setTargetPlayerId] = useState(null);
            const [targetHistoryId, setTargetHistoryId] = useState(null);

            // --- Handlers ---
            const handleAddPlayer = () => {
                const newPlayer = {
                    name: 'ìƒˆ ì„ ìˆ˜', role: 'TOP', tier: 'B', isCaptain: false, id: `p_${Date.now()}_new`,
                    lolNick: '', rankTier: '', sig1: '', sig2: '', sig3: '', champPool: '',
                    laningPros: '', laningCons: '', teamfightPros: '', teamfightCons: ''
                };
                setEditingPlayer(newPlayer); setActiveModal('add_player');
            };
            const handleConfirmAddPlayer = () => {
                if (!editingPlayer) return;
                setPlayers(prev => [...prev, editingPlayer]);
                setInitialPoints(prev => ({ ...prev, [editingPlayer.name]: 1000 }));
                closeModal(); setCopyMsg('ì„ ìˆ˜ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.'); setTimeout(() => setCopyMsg(''), 3000);
            };
            const handleRemovePlayer = (id) => { setTargetPlayerId(id); setActiveModal('delete_confirm'); };
            const handleConfirmDelete = () => {
                if (!targetPlayerId) return;
                setPlayers(prev => prev.filter(p => p.id !== targetPlayerId));
                closeModal(); setTargetPlayerId(null); setCopyMsg('ì„ ìˆ˜ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.'); setTimeout(() => setCopyMsg(''), 3000);
            };
            const handleTierChange = (id, newTier) => setPlayers(prev => prev.map(p => p.id === id ? { ...p, tier: newTier } : p));
            const handleRoleChange = (id, newRole) => setPlayers(prev => prev.map(p => p.id === id ? { ...p, role: newRole } : p));
            const handleNameChange = (id, newName) => {
                const playerIndex = players.findIndex(p => p.id === id); if (playerIndex === -1) return;
                const oldName = players[playerIndex].name;
                if (initialPoints[oldName] !== undefined) {
                    setInitialPoints(prev => { const val = prev[oldName]; const next = { ...prev }; delete next[oldName]; next[newName] = val; return next; });
                }
                setPlayers(prev => prev.map(p => p.id === id ? { ...p, name: newName } : p));
            };
            const handleDetailChange = (id, field, value) => {
                setPlayers(prev => prev.map(p => p.id === id ? { ...p, [field]: value } : p));
                if (editingPlayer && editingPlayer.id === id) setEditingPlayer(prev => ({ ...prev, [field]: value }));
            };
            const handleNewPlayerChange = (field, value) => setEditingPlayer(prev => ({ ...prev, [field]: value }));
            const toggleCaptain = (id) => setPlayers(prev => prev.map(p => { if (p.id === id) return { ...p, isCaptain: !p.isCaptain }; return p; }));
            const handlePointChange = (playerName, newPoints) => setInitialPoints(prev => ({ ...prev, [playerName]: parseInt(newPoints) || 0 }));
            
            const closeModal = () => { setActiveModal(null); setModalInputValue(''); setModalMessage(''); setEditingPlayer(null); setTargetPlayerId(null); setTargetHistoryId(null); };
            const showAlert = (msg) => { setModalMessage(msg); setActiveModal('alert'); };
            const openDetailModal = (player) => { setEditingPlayer(player); setActiveModal('detail_edit'); };
            
            const confirmReset = () => {
                localStorage.removeItem('lol_auction_players_v2'); localStorage.removeItem('lol_auction_points_v2');
                setPlayers(initializePlayers(INITIAL_PLAYERS));
                const points = {}; INITIAL_PLAYERS.forEach(p => { points[p.name] = 1000; }); setInitialPoints(points);
                setCopyMsg('ì„¤ì •ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.'); closeModal(); setTimeout(() => setCopyMsg(''), 3000);
            };
            
            const handleExportData = () => {
                const data = { players, initialPoints };
                const code = btoa(unescape(encodeURIComponent(JSON.stringify(data))));
                const textarea = document.createElement("textarea");
                textarea.value = code;
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    const successful = document.execCommand('copy');
                    if (successful) setCopyMsg('ë°ì´í„° ì½”ë“œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    else throw new Error('fail');
                } catch (err) {
                    setModalInputValue(code);
                    setActiveModal('export');
                }
                document.body.removeChild(textarea);
                setTimeout(() => setCopyMsg(''), 3000);
            };
            
            const submitImport = () => {
                const code = modalInputValue.trim();
                if (!code) { setCopyMsg("ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }
                try {
                    const decoded = decodeURIComponent(escape(atob(code))); const data = JSON.parse(decoded);
                    if (data.players && data.initialPoints) {
                        setPlayers(initializePlayers(data.players)); setInitialPoints(data.initialPoints);
                        localStorage.setItem('lol_auction_players_v2', JSON.stringify(data.players));
                        localStorage.setItem('lol_auction_points_v2', JSON.stringify(data.initialPoints));
                        setCopyMsg('ì„¤ì •ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!'); closeModal();
                    } else { setCopyMsg("ì˜ëª»ëœ ë°ì´í„° í˜•ì‹ì…ë‹ˆë‹¤."); }
                } catch (e) { setCopyMsg("ì½”ë“œë¥¼ í•´ì„í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."); }
                setTimeout(() => setCopyMsg(''), 3000);
            };

            const saveHistory = () => {
                const currentState = { teams: JSON.parse(JSON.stringify(teams)), auctionQueue: [...auctionQueue], currentBid: currentBid ? {...currentBid} : null, unsoldList: [...unsoldList] };
                setHistory(prev => [...prev, currentState]);
            };
            const undoAction = () => {
                if (history.length === 0) return;
                const lastState = history[history.length - 1];
                setTeams(lastState.teams); setAuctionQueue(lastState.auctionQueue); setCurrentBid(lastState.currentBid); setUnsoldList(lastState.unsoldList);
                setHistory(prev => prev.slice(0, -1)); setBidPrice(''); setErrorMsg('');
            };

            const startAuction = () => {
                if (selectedCaptains.length !== 4) { showAlert(`íŒ€ì¥ì€ ì •í™•íˆ 4ëª…ì´ì–´ì•¼ í•©ë‹ˆë‹¤.\ní˜„ì¬ ì„ íƒëœ íŒ€ì¥: ${selectedCaptains.length}ëª…`); return; }
                const newTeams = selectedCaptains.map(name => ({ captain: name, points: initialPoints[name], members: [{ name: name, price: 0 }] }));
                setTeams(newTeams);
                const pool = players.filter(p => !p.isCaptain);
                for (let i = pool.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [pool[i], pool[j]] = [pool[j], pool[i]]; }
                setAuctionQueue(pool); setUnsoldList([]); setCurrentBid(null); setBidPrice(''); setErrorMsg(''); setHistory([]); setView('auction');
            };

            const drawNextPlayer = () => { if (auctionQueue.length === 0) return; saveHistory(); const next = auctionQueue[0]; setCurrentBid(next); setAuctionQueue(prev => prev.slice(1)); setBidPrice(''); setErrorMsg(''); };
            const confirmPurchase = (teamIndex) => {
                const price = parseInt(bidPrice); if (isNaN(price) || price < 0) { setErrorMsg("ì˜¬ë°”ë¥¸ í¬ì¸íŠ¸ ì…ë ¥"); return; }
                if (teams[teamIndex].points < price) { setErrorMsg("í¬ì¸íŠ¸ ë¶€ì¡±!"); return; }
                saveHistory();
                setTeams(prev => prev.map((t, idx) => { if (idx === teamIndex) { return { ...t, points: t.points - price, members: [...t.members, { name: currentBid.name, price: price }] }; } return t; }));
                setCurrentBid(null); setErrorMsg('');
            };
            const handleUnsold = () => { saveHistory(); setUnsoldList(prev => [...prev, currentBid]); setCurrentBid(null); setErrorMsg(''); };
            const reviveUnsoldPlayer = (player) => { if (currentBid) return; saveHistory(); setUnsoldList(prev => prev.filter(p => p.name !== player.name)); setCurrentBid(player); setBidPrice(''); setErrorMsg(''); };
            const confirmGoHome = () => { closeModal(); setView('setup'); setCurrentBid(null); };

            // ê²°ê³¼ ì €ì¥ (ê¸°ë¡ì‹¤ìš©)
            const handleSaveResult = () => {
                const timestamp = new Date().toLocaleString();
                const newRecord = {
                    id: Date.now(),
                    date: timestamp,
                    teams: JSON.parse(JSON.stringify(teams)), // Deep copy
                    unsold: [...unsoldList]
                };
                setSavedHistories(prev => [newRecord, ...prev]);
                setCopyMsg('ê²°ê³¼ê°€ ê¸°ë¡ì‹¤ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
                setTimeout(() => setCopyMsg(''), 3000);
            };

            const handleDeleteHistory = (id) => {
                setTargetHistoryId(id);
                setActiveModal('history_delete_confirm');
            };

            const confirmDeleteHistory = () => {
                if (targetHistoryId) {
                    setSavedHistories(prev => prev.filter(h => h.id !== targetHistoryId));
                    setCopyMsg('ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    setTimeout(() => setCopyMsg(''), 3000);
                }
                setActiveModal('history');
                setTargetHistoryId(null);
            };

            const cancelDeleteHistory = () => {
                setActiveModal('history');
                setTargetHistoryId(null);
            };

            const generateResultText = (teamsData, unsoldData) => {
                let text = "ğŸ† ë¡¤ ë©¸ë§ì „ íŒ€ êµ¬ì„± ê²°ê³¼ ğŸ†\n\n";
                teamsData.forEach(team => {
                    const stats = calculateTeamStats(team.members, players);
                    text += `[${team.captain} íŒ€] (ë‚¨ì€ í¬ì¸íŠ¸: ${team.points}P)\n`;
                    text += `í‹°ì–´ í˜„í™©: í‰ê·  ${stats.avg} (Max ${stats.max} / Min ${stats.min})\n`;
                    ROLES.forEach(role => {
                        const member = team.members.find(m => { const p = players.find(p => p.name === m.name); return p && p.role === role; });
                        if (member) {
                            const pData = players.find(p => p.name === member.name);
                            const priceText = pData.isCaptain ? ' (íŒ€ì¥)' : ` - ${member.price}P`;
                            const rankInfo = pData.lolNick || pData.rankTier ? ` [${pData.rankTier || '-'} / ${pData.lolNick || '-'}]` : '';
                            text += `${role}: ${member.name}${rankInfo} (${pData.tier})${priceText}\n`;
                        } else { text += `${role}: (ê³µì„)\n`; }
                    });
                    text += `\n`;
                });
                if (unsoldData && unsoldData.length > 0) { text += `âš ï¸ ìœ ì°° ëª©ë¡ (${unsoldData.length}ëª…)\n`; text += unsoldData.map(p => `${p.name}(${p.tier})`).join(', '); }
                return text;
            };

            const handleCopyHistory = (historyItem) => {
                const text = generateResultText(historyItem.teams, historyItem.unsold);
                const textarea = document.createElement("textarea"); textarea.value = text; document.body.appendChild(textarea); textarea.select();
                try { document.execCommand('copy'); setCopyMsg("ê¸°ë¡ ë³µì‚¬ ì™„ë£Œ!"); } catch (err) { setCopyMsg("ë³µì‚¬ ì‹¤íŒ¨"); }
                document.body.removeChild(textarea); setTimeout(() => setCopyMsg(''), 3000);
            };

            const handleCopyCurrentResults = () => {
                const text = generateResultText(teams, unsoldList);
                if (auctionQueue.length > 0) { /* ë‚¨ì€ ë§¤ë¬¼ ì¶”ê°€ ë¡œì§ì€ ìƒëµ (ê¸°ë¡ì‹¤ìš© í•¨ìˆ˜ ì¬ì‚¬ìš© ìœ„í•´) */ }
                const textarea = document.createElement("textarea"); textarea.value = text; document.body.appendChild(textarea); textarea.select();
                try { document.execCommand('copy'); setCopyMsg("ê²°ê³¼ ë³µì‚¬ ì™„ë£Œ!"); } catch (err) { setCopyMsg("ë³µì‚¬ ì‹¤íŒ¨"); }
                document.body.removeChild(textarea); setTimeout(() => setCopyMsg(''), 3000);
            };

            return (
                <div className="min-h-screen relative">
                    {/* ëª¨ë‹¬ */}
                    {activeModal && (
                        <div className="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4 backdrop-blur-sm fade-in">
                            <div className={`bg-slate-800 border border-slate-600 rounded-xl p-6 shadow-2xl relative ${activeModal === 'history' ? 'max-w-2xl w-full' : 'max-w-lg w-full'}`}>
                                <button onClick={closeModal} className="absolute top-4 right-4 text-slate-400 hover:text-white"><XIcon className="w-6 h-6" /></button>
                                
                                {activeModal === 'alert' && <div className="text-center"><h3 className="text-xl font-bold text-white mb-4 flex justify-center items-center gap-2"><AlertCircle className="text-yellow-500 w-6 h-6" /> ì•Œë¦¼</h3><p className="text-slate-300 mb-6 whitespace-pre-line">{modalMessage}</p><button onClick={closeModal} className="bg-blue-600 text-white px-6 py-2 rounded-lg font-bold">í™•ì¸</button></div>}
                                
                                {activeModal === 'history' && (
                                    <div>
                                        <h3 className="text-xl font-bold text-white mb-4 flex items-center gap-2"><HistoryIcon className="text-yellow-400 w-6 h-6" /> ê¸°ë¡ì‹¤ (ëª…ì˜ˆì˜ ì „ë‹¹)</h3>
                                        <div className="max-h-[60vh] overflow-y-auto custom-scroll space-y-3">
                                            {savedHistories.length === 0 ? <p className="text-center text-slate-500 py-8">ì €ì¥ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p> : 
                                            savedHistories.map(item => (
                                                <div key={item.id} className="bg-slate-900 border border-slate-700 rounded-lg p-4 flex flex-col gap-2">
                                                    <div className="flex justify-between items-center border-b border-slate-700 pb-2">
                                                        <span className="text-emerald-400 font-bold text-sm">{item.date}</span>
                                                        <div className="flex gap-2">
                                                            <button onClick={() => handleCopyHistory(item)} className="text-blue-400 hover:text-white text-xs border border-blue-900 bg-blue-900/20 px-2 py-1 rounded">í…ìŠ¤íŠ¸ ë³µì‚¬</button>
                                                            <button onClick={() => handleDeleteHistory(item.id)} className="text-red-400 hover:text-white text-xs border border-red-900 bg-red-900/20 px-2 py-1 rounded">ì‚­ì œ</button>
                                                        </div>
                                                    </div>
                                                    <div className="grid grid-cols-2 gap-2 text-xs">
                                                        {item.teams.map(t => (
                                                            <div key={t.captain} className="text-slate-300">
                                                                <span className="text-yellow-500 font-bold">{t.captain}íŒ€</span> : 
                                                                {t.members.filter(m => m.name !== t.captain).map(m => ` ${m.name}`).join(',')}
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                                
                                {activeModal === 'history_delete_confirm' && (
                                    <div className="text-center">
                                        <h3 className="text-xl font-bold text-white mb-4 flex justify-center items-center gap-2">
                                            <AlertCircle className="text-red-500 w-6 h-6" /> ê¸°ë¡ ì‚­ì œ
                                        </h3>
                                        <p className="text-slate-300 mb-6">ì •ë§ ì´ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
                                        <div className="flex justify-center gap-3">
                                            <button onClick={cancelDeleteHistory} className="px-4 py-2 rounded bg-slate-700 text-slate-300 hover:bg-slate-600">ì·¨ì†Œ</button>
                                            <button onClick={confirmDeleteHistory} className="px-4 py-2 rounded bg-red-600 text-white hover:bg-red-500 font-bold">ì‚­ì œ</button>
                                        </div>
                                    </div>
                                )}

                                {/* ... ê¸°ì¡´ ëª¨ë‹¬ë“¤ (detail_edit, add_player, delete_confirm, import, export, reset, home_confirm) ìœ ì§€ ... */}
                                {activeModal === 'detail_edit' && editingPlayer && (
                                    /* ìƒì„¸ ìˆ˜ì • ëª¨ë‹¬ ì½”ë“œ ìƒëµ (ìœ„ì™€ ë™ì¼) */
                                    <div><h3 className="text-xl font-bold text-white mb-4"><FileText className="text-blue-400 w-6 h-6 inline mr-2"/>{editingPlayer.name} ë¶„ì„</h3>
                                    <div className="space-y-4 max-h-[70vh] overflow-y-auto pr-2 custom-scroll">
                                        <div className="grid grid-cols-2 gap-3 mb-2 p-3 bg-slate-900/50 rounded-lg border border-slate-700"><div><label className="block text-sm text-slate-400 font-bold mb-1">ğŸ†” ë¡¤ ë‹‰ë„¤ì„</label><input type="text" value={editingPlayer.lolNick} onChange={(e)=>handleDetailChange(editingPlayer.id,'lolNick',e.target.value)} className="w-full bg-slate-800 border border-slate-600 rounded p-2 text-sm text-white"/></div><div><label className="block text-sm text-yellow-500 font-bold mb-1">ğŸ† ì†”ë­ í‹°ì–´</label><input type="text" value={editingPlayer.rankTier} onChange={(e)=>handleDetailChange(editingPlayer.id,'rankTier',e.target.value)} className="w-full bg-slate-800 border border-slate-600 rounded p-2 text-sm text-white"/></div></div>
                                        <div><label className="block text-sm text-yellow-400 font-bold mb-1">â­ ì‹œê·¸ë‹ˆì²˜ í”½</label><div className="flex gap-2 mb-2"><input placeholder="Pick1" value={editingPlayer.sig1} onChange={(e)=>handleDetailChange(editingPlayer.id,'sig1',e.target.value)} className="w-1/3 bg-slate-900 border border-slate-600 rounded p-2 text-sm text-white"/><input placeholder="Pick2" value={editingPlayer.sig2} onChange={(e)=>handleDetailChange(editingPlayer.id,'sig2',e.target.value)} className="w-1/3 bg-slate-900 border border-slate-600 rounded p-2 text-sm text-white"/><input placeholder="Pick3" value={editingPlayer.sig3} onChange={(e)=>handleDetailChange(editingPlayer.id,'sig3',e.target.value)} className="w-1/3 bg-slate-900 border border-slate-600 rounded p-2 text-sm text-white"/></div><label className="block text-sm text-slate-400 font-bold mb-1">ğŸ“‹ ì±”í”„í­</label><textarea value={editingPlayer.champPool} onChange={(e)=>handleDetailChange(editingPlayer.id,'champPool',e.target.value)} className="w-full bg-slate-900 border border-slate-600 rounded p-2 text-sm text-white h-16"/></div>
                                        <div className="grid grid-cols-2 gap-3"><div><label className="block text-sm text-blue-400 font-bold mb-1">ğŸ›¡ï¸ ë¼ì¸ì „ ì¥ì </label><textarea value={editingPlayer.laningPros} onChange={(e)=>handleDetailChange(editingPlayer.id,'laningPros',e.target.value)} className="w-full bg-slate-900 border border-slate-600 rounded p-2 text-sm text-white h-16"/></div><div><label className="block text-sm text-red-400 font-bold mb-1">ğŸ›¡ï¸ ë¼ì¸ì „ ë‹¨ì </label><textarea value={editingPlayer.laningCons} onChange={(e)=>handleDetailChange(editingPlayer.id,'laningCons',e.target.value)} className="w-full bg-slate-900 border border-slate-600 rounded p-2 text-sm text-white h-16"/></div></div>
                                        <div className="grid grid-cols-2 gap-3"><div><label className="block text-sm text-purple-400 font-bold mb-1">ğŸ’¥ í•œíƒ€ ì¥ì </label><textarea value={editingPlayer.teamfightPros} onChange={(e)=>handleDetailChange(editingPlayer.id,'teamfightPros',e.target.value)} className="w-full bg-slate-900 border border-slate-600 rounded p-2 text-sm text-white h-16"/></div><div><label className="block text-sm text-red-400 font-bold mb-1">ğŸ’¥ í•œíƒ€ ë‹¨ì </label><textarea value={editingPlayer.teamfightCons} onChange={(e)=>handleDetailChange(editingPlayer.id,'teamfightCons',e.target.value)} className="w-full bg-slate-900 border border-slate-600 rounded p-2 text-sm text-white h-16"/></div></div>
                                    </div><div className="flex justify-end mt-6 pt-4 border-t border-slate-700"><button onClick={closeModal} className="bg-emerald-600 text-white px-6 py-2 rounded-lg font-bold">ì €ì¥</button></div></div>
                                )}
                                {activeModal === 'add_player' && editingPlayer && (
                                    /* ì„ ìˆ˜ ì¶”ê°€ ëª¨ë‹¬ ì½”ë“œ ìƒëµ (ìœ„ì™€ ë™ì¼) */
                                    <div><h3 className="text-xl font-bold text-white mb-4"><Plus className="text-emerald-400 w-6 h-6 inline mr-2"/>ìƒˆ ì„ ìˆ˜ ë“±ë¡</h3>
                                    <div className="space-y-4 max-h-[70vh] overflow-y-auto pr-2 custom-scroll">
                                        <div className="bg-slate-900/50 p-3 rounded-lg border border-slate-700 mb-4"><div className="mb-3"><label className="block text-sm text-slate-300 font-bold mb-1">ì´ë¦„</label><input type="text" value={editingPlayer.name} onChange={(e)=>handleNewPlayerChange('name',e.target.value)} className="w-full bg-slate-800 border border-slate-600 rounded p-2 text-white" placeholder="ì´ë¦„"/></div><div className="flex gap-3"><div className="flex-1"><label className="block text-sm text-slate-300 font-bold mb-1">í¬ì§€ì…˜</label><select value={editingPlayer.role} onChange={(e)=>handleNewPlayerChange('role',e.target.value)} className="w-full bg-slate-800 border border-slate-600 rounded p-2 text-white">{ROLES.map(r=><option key={r} value={r}>{r}</option>)}</select></div><div className="flex-1"><label className="block text-sm text-slate-300 font-bold mb-1">ë“±ê¸‰</label><select value={editingPlayer.tier} onChange={(e)=>handleNewPlayerChange('tier',e.target.value)} className={`w-full bg-slate-800 border border-slate-600 rounded p-2 font-bold ${TIER_COLORS[editingPlayer.tier]}`}>{TIERS.map(t=><option key={t} value={t} className="text-white">{t}</option>)}</select></div></div></div>
                                        <div className="grid grid-cols-2 gap-3"><div><label className="block text-sm text-slate-400 font-bold mb-1">ğŸ†” ë¡¤ ë‹‰ë„¤ì„</label><input value={editingPlayer.lolNick} onChange={(e)=>handleNewPlayerChange('lolNick',e.target.value)} className="w-full bg-slate-800 border border-slate-600 rounded p-2 text-sm text-white"/></div><div><label className="block text-sm text-yellow-500 font-bold mb-1">ğŸ† ì†”ë­ í‹°ì–´</label><input value={editingPlayer.rankTier} onChange={(e)=>handleNewPlayerChange('rankTier',e.target.value)} className="w-full bg-slate-800 border border-slate-600 rounded p-2 text-sm text-white"/></div></div>
                                        {/* ... ê¸°íƒ€ í•„ë“œ ìƒëµ ... */}
                                    </div><div className="flex justify-end mt-6 pt-4 border-t border-slate-700 gap-2"><button onClick={closeModal} className="px-4 py-2 rounded bg-slate-700">ì·¨ì†Œ</button><button onClick={handleConfirmAddPlayer} className="bg-emerald-600 text-white px-6 py-2 rounded-lg font-bold">ë“±ë¡</button></div></div>
                                )}
                                {activeModal === 'delete_confirm' && <div className="text-center"><h3 className="text-xl font-bold text-white mb-4"><AlertCircle className="text-red-500 w-6 h-6 inline mr-2"/>ì„ ìˆ˜ ì‚­ì œ</h3><p className="text-slate-300 mb-6">ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p><div className="flex justify-center gap-3"><button onClick={closeModal} className="px-4 py-2 rounded bg-slate-700">ì·¨ì†Œ</button><button onClick={handleConfirmDelete} className="px-4 py-2 rounded bg-red-600 font-bold">ì‚­ì œ</button></div></div>}
                                {activeModal === 'import' && <div><h3 className="text-xl font-bold text-white mb-2"><CloudDownload className="text-emerald-400 w-6 h-6 inline mr-2"/>ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°</h3><textarea value={modalInputValue} onChange={(e)=>setModalInputValue(e.target.value)} className="w-full bg-slate-950 border border-slate-600 rounded-lg p-3 text-sm text-white h-32 mb-4" placeholder="ì½”ë“œë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”"/><div className="flex justify-end gap-2"><button onClick={closeModal} className="px-4 py-2 rounded bg-slate-700">ì·¨ì†Œ</button><button onClick={submitImport} className="px-4 py-2 rounded bg-emerald-600 font-bold">ë¶ˆëŸ¬ì˜¤ê¸°</button></div></div>}
                                {activeModal === 'export' && (
                                    <div>
                                        <h3 className="text-xl font-bold text-white mb-2 flex items-center gap-2"><CloudUpload className="text-blue-400 w-6 h-6" /> ë°ì´í„° ì½”ë“œ ë³µì‚¬</h3>
                                        <textarea readOnly value={modalInputValue} className="w-full bg-slate-950 border border-slate-600 rounded-lg p-3 text-sm text-slate-300 h-32 mb-4 select-all" />
                                        <div className="flex justify-end"><button onClick={closeModal} className="px-6 py-2 rounded bg-blue-600 font-bold">ë‹«ê¸°</button></div>
                                    </div>
                                )}
                                {activeModal === 'reset' && <div className="text-center"><h3 className="text-xl font-bold text-white mb-4"><AlertCircle className="text-red-500 w-6 h-6 inline mr-2"/>ì„¤ì • ì´ˆê¸°í™”</h3><p className="text-slate-300 mb-6">ëª¨ë“  ì„¤ì •ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p><div className="flex justify-center gap-3"><button onClick={closeModal} className="px-4 py-2 rounded bg-slate-700">ì·¨ì†Œ</button><button onClick={confirmReset} className="px-4 py-2 rounded bg-red-600 font-bold">ì´ˆê¸°í™”</button></div></div>}
                                {activeModal === 'home_confirm' && <div className="text-center"><h3 className="text-xl font-bold text-white mb-4"><Home className="text-blue-400 w-6 h-6 inline mr-2"/>í™ˆìœ¼ë¡œ ì´ë™</h3><p className="text-slate-300 mb-6">ì§„í–‰ ì¤‘ì¸ ê²½ë§¤ê°€ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.</p><div className="flex justify-center gap-3"><button onClick={closeModal} className="px-4 py-2 rounded bg-slate-700">ì·¨ì†Œ</button><button onClick={confirmGoHome} className="px-4 py-2 rounded bg-blue-600 font-bold">í™•ì¸</button></div></div>}
                            </div>
                        </div>
                    )}

                    {copyMsg && <div className="fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-blue-600 text-white px-6 py-3 rounded-full shadow-2xl z-50 fade-in flex items-center gap-2"><CopyIcon className="w-5 h-5" /> {copyMsg}</div>}

                    {view === 'setup' ? (
                        <div className="max-w-6xl mx-auto p-6 bg-slate-900 min-h-screen text-slate-100">
                            <header className="mb-8 flex flex-col md:flex-row justify-between items-center relative gap-4">
                                <div className="flex-1 flex gap-2">
                                    <button onClick={handleExportData} className="text-blue-300 hover:text-white flex items-center gap-1 text-sm border border-blue-900/50 bg-blue-900/20 px-3 py-1.5 rounded-lg"><CloudUpload className="w-4 h-4" /> ë‚´ë³´ë‚´ê¸°</button>
                                    <button onClick={() => setActiveModal('import')} className="text-emerald-300 hover:text-white flex items-center gap-1 text-sm border border-emerald-900/50 bg-emerald-900/20 px-3 py-1.5 rounded-lg"><CloudDownload className="w-4 h-4" /> ê°€ì ¸ì˜¤ê¸°</button>
                                </div>
                                <div className="text-center flex-1">
                                    <h1 className="text-3xl font-bold text-yellow-500 mb-2 flex justify-center items-center gap-3"><Trophy className="w-10 h-10" /> ë¡¤ ë©¸ë§ì „ ë“œë˜í”„íŠ¸</h1>
                                    <p className="text-slate-400">ì„ ìˆ˜ ì •ë³´ ìë™ ì €ì¥ë¨</p>
                                </div>
                                <div className="flex-1 flex justify-end gap-2 mt-4 md:mt-0">
                                    <button onClick={() => setActiveModal('history')} className="text-yellow-400 hover:text-yellow-200 flex items-center gap-1 text-sm border border-yellow-600 bg-yellow-900/30 px-3 py-1.5 rounded-lg mr-2"><HistoryIcon className="w-4 h-4" /> ê¸°ë¡ì‹¤</button>
                                    <button onClick={handleAddPlayer} className="text-emerald-300 hover:text-emerald-100 flex items-center gap-1 text-sm border border-emerald-700 px-3 py-1.5 rounded-lg mr-2"><Plus className="w-4 h-4" /> ì„ ìˆ˜ ì¶”ê°€</button>
                                    <button onClick={() => setActiveModal('reset')} className="text-slate-500 hover:text-white flex items-center gap-1 text-sm border border-slate-700 px-3 py-1.5 rounded-lg"><RefreshIcon className="w-4 h-4" /> ì´ˆê¸°í™”</button>
                                </div>
                            </header>

                            <div className="bg-slate-800 p-6 rounded-xl border border-slate-700 mb-8 shadow-lg">
                                <h2 className="text-xl font-bold mb-4 flex items-center gap-2 text-yellow-400"><Gavel className="w-5 h-5" /> íŒ€ì¥ í¬ì¸íŠ¸ ({selectedCaptains.length}/4)</h2>
                                {selectedCaptains.length > 0 ? (
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                        {selectedCaptains.map((captainName) => (
                                            <div key={captainName} className="bg-slate-700 p-4 rounded-lg flex flex-col gap-2 fade-in border border-yellow-500/30">
                                                <span className="font-bold text-lg text-white flex items-center gap-1 truncate"><Crown className="w-4 h-4 text-yellow-400 flex-shrink-0" /> {captainName}</span>
                                                <input type="number" value={initialPoints[captainName]} onChange={(e) => handlePointChange(captainName, e.target.value)} className="w-full bg-slate-900 border border-slate-600 rounded px-3 py-2 text-white focus:ring-2 focus:ring-yellow-500 outline-none" placeholder="í¬ì¸íŠ¸" />
                                            </div>
                                        ))}
                                    </div>
                                ) : <div className="text-center py-4 text-slate-500">íŒ€ì¥ì„ ì„ íƒí•˜ë©´ í¬ì¸íŠ¸ ì…ë ¥ì¹¸ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</div>}
                            </div>

                            <div className="bg-slate-800 p-6 rounded-xl border border-slate-700 mb-8 shadow-lg">
                                <h2 className="text-xl font-bold mb-4 flex items-center gap-2 text-blue-400"><Users className="w-5 h-5" /> ì„ ìˆ˜ ëª©ë¡</h2>
                                <div className="grid grid-cols-1 md:grid-cols-5 gap-6">
                                    {ROLES.map(role => (
                                        <div key={role} className="flex flex-col gap-3">
                                            <h3 className="text-center font-bold text-slate-300 bg-slate-700 py-1 rounded">{role}</h3>
                                            {players.filter(p => p.role === role)
                                                .sort((a, b) => {
                                                    if (a.isCaptain && !b.isCaptain) return -1;
                                                    if (!a.isCaptain && b.isCaptain) return 1;
                                                    return TIER_SCORES[b.tier] - TIER_SCORES[a.tier];
                                                })
                                                .map(player => (
                                                <div key={player.id} className={`flex flex-col gap-2 bg-slate-700/50 p-2 rounded border list-item-move ${player.isCaptain ? 'border-yellow-500 bg-slate-700' : 'border-slate-600'}`}>
                                                    <div className="flex items-center gap-2 w-full">
                                                        <button onClick={() => toggleCaptain(player.id)} className={`p-1 rounded-full flex-shrink-0 ${player.isCaptain ? 'text-yellow-400 bg-yellow-400/20' : 'text-slate-600 hover:text-slate-400'}`} title="íŒ€ì¥ í† ê¸€"><Crown className="w-4 h-4" /></button>
                                                        <input type="text" value={player.name} onChange={(e) => handleNameChange(player.id, e.target.value)} className={`bg-transparent border-b border-transparent hover:border-slate-500 focus:border-blue-500 focus:outline-none w-full font-medium ${player.isCaptain ? 'text-yellow-200' : 'text-slate-200'}`} />
                                                        <button onClick={() => openDetailModal(player)} className="p-1 rounded text-slate-400 hover:text-white" title="ìƒì„¸ ë¶„ì„"><FileText className="w-4 h-4" /></button>
                                                        <button onClick={() => handleRemovePlayer(player.id)} className="p-1 rounded text-slate-500 hover:text-red-400" title="ì„ ìˆ˜ ì‚­ì œ"><Trash2 className="w-4 h-4" /></button>
                                                    </div>
                                                    <div className="flex gap-1">
                                                        <select value={player.role} onChange={(e) => handleRoleChange(player.id, e.target.value)} className="bg-slate-900 text-xs border border-slate-600 rounded px-1 py-1 w-16 focus:outline-none text-slate-300">
                                                            {ROLES.map(r => <option key={r} value={r}>{r}</option>)}
                                                        </select>
                                                        <select value={player.tier} onChange={(e) => handleTierChange(player.id, e.target.value)} className={`bg-slate-900 text-xs border border-slate-600 rounded px-1 py-1 flex-1 focus:outline-none font-bold ${TIER_COLORS[player.tier]}`}>
                                                            {TIERS.map(t => <option key={t} value={t} className="text-white">{t}</option>)}
                                                        </select>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    ))}
                                </div>
                            </div>

                            <div className="flex justify-center flex-col items-center gap-4">
                                <div className="flex gap-4 flex-wrap justify-center">
                                    <button onClick={startAuction} disabled={selectedCaptains.length !== 4} className={`text-white text-xl font-bold py-3 px-10 rounded-full shadow-xl flex items-center gap-3 ${selectedCaptains.length === 4 ? 'bg-blue-600 hover:bg-blue-500 hover:scale-105 cursor-pointer' : 'bg-slate-700 text-slate-400 cursor-not-allowed'}`}>ê²½ë§¤ ì‹œì‘í•˜ê¸° <ArrowRight className="w-6 h-6" /></button>
                                </div>
                                {selectedCaptains.length !== 4 && <p className="text-red-400 font-bold animate-pulse">* íŒ€ì¥ì„ 4ëª… ì„ íƒí•´ì•¼ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>}
                            </div>
                        </div>
                    ) : (
                        <div className="bg-slate-950 min-h-screen text-white p-4 flex flex-col">
                            <div className="flex justify-between items-center mb-6 px-4">
                                <button onClick={() => setActiveModal('home_confirm')} className="flex items-center gap-2 text-slate-400 hover:text-white transition-colors text-sm md:text-base"><Home className="w-5 h-5" /> <span className="hidden md:inline">ì„¤ì •/í™ˆ</span></button>
                                <div className="flex items-center gap-4">
                                    {history.length > 0 && <button onClick={undoAction} className="flex items-center gap-2 bg-slate-700 hover:bg-slate-600 text-slate-200 px-3 py-1.5 rounded-lg text-sm font-bold shadow-lg border border-slate-500/30"><UndoIcon className="w-4 h-4" /> ì‹¤í–‰ ì·¨ì†Œ</button>}
                                    <button onClick={handleSaveResult} className="flex items-center gap-2 bg-indigo-600 hover:bg-indigo-500 text-white px-3 py-1.5 rounded-lg text-sm font-bold shadow-lg border border-indigo-400/30"><SaveIcon className="w-4 h-4" /> ê²°ê³¼ ì €ì¥</button>
                                    <button onClick={handleCopyCurrentResults} className="flex items-center gap-2 bg-emerald-600 hover:bg-emerald-500 text-white px-3 py-1.5 rounded-lg text-sm font-bold shadow-lg border border-emerald-400/30"><CopyIcon className="w-4 h-4" /> ê²°ê³¼ ë³µì‚¬</button>
                                </div>
                            </div>

                            <div className="flex-1 flex flex-col lg:flex-row gap-6 mb-8 px-4">
                                <div className="flex-1 flex flex-col items-center justify-start">
                                    <div className="w-full max-w-2xl text-center">
                                        {!currentBid ? (
                                            <div className="py-12 bg-slate-900/80 rounded-2xl border-2 border-dashed border-slate-700 flex flex-col items-center justify-center gap-4 h-full min-h-[300px]">
                                                {auctionQueue.length > 0 ? (
                                                    <>
                                                        <p className="text-slate-400 text-lg">ë‹¤ìŒ ì„ ìˆ˜ë¥¼ ë½‘ì•„ì£¼ì„¸ìš”</p>
                                                        <button onClick={drawNextPlayer} className="bg-yellow-600 hover:bg-yellow-500 text-white font-bold py-3 px-8 rounded-full text-lg shadow-lg animate-pulse">ë§¤ë¬¼ ë½‘ê¸°</button>
                                                    </>
                                                ) : <p className="text-green-400 text-xl font-bold">ëª¨ë“  ê²½ë§¤ê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</p>}
                                            </div>
                                        ) : (
                                            <div className="bg-gradient-to-b from-slate-800 to-slate-900 p-8 rounded-2xl border-2 border-blue-500 shadow-[0_0_30px_rgba(59,130,246,0.3)] relative overflow-hidden flex flex-col items-center">
                                                <div className="absolute top-0 left-0 w-full h-2 bg-blue-500"></div>
                                                <div className="mb-2 text-blue-400 font-bold text-xl tracking-widest">{currentBid.role}</div>
                                                <h2 className="text-6xl font-black text-white mb-2 drop-shadow-md">{currentBid.name}</h2>
                                                
                                                {(currentBid.lolNick || currentBid.rankTier) && (
                                                    <div className="flex items-center gap-2 mb-2 bg-slate-900/80 px-4 py-1.5 rounded-full border border-slate-700 shadow-sm">
                                                        {currentBid.lolNick && <span className="text-slate-300 font-medium text-sm flex items-center gap-1">ğŸ†” {currentBid.lolNick}</span>}
                                                        {currentBid.lolNick && currentBid.rankTier && <span className="text-slate-600 text-xs">|</span>}
                                                        {currentBid.rankTier && <span className="text-yellow-500 font-bold text-sm flex items-center gap-1">ğŸ† {currentBid.rankTier}</span>}
                                                    </div>
                                                )}

                                                <div className={`inline-block bg-slate-800 px-6 py-2 rounded-full text-3xl font-black mb-6 border border-slate-600 ${TIER_COLORS[currentBid.tier]}`}>{currentBid.tier}</div>
                                                
                                                {(currentBid.sig1 || currentBid.sig2 || currentBid.sig3 || currentBid.champPool || currentBid.laningPros || currentBid.laningCons || currentBid.teamfightPros || currentBid.teamfightCons) && (
                                                    <div className="w-full bg-slate-950/50 rounded-lg p-3 mb-4 text-left space-y-3 border border-slate-700/50 text-sm">
                                                        {(currentBid.sig1 || currentBid.sig2 || currentBid.sig3 || currentBid.champPool) && (
                                                            <div>
                                                                <span className="text-yellow-400 font-bold block mb-1">âš”ï¸ ì±”í”„í­</span>
                                                                <div className="pl-2 space-y-1">
                                                                    {(currentBid.sig1 || currentBid.sig2 || currentBid.sig3) && (
                                                                        <div className="flex gap-2 flex-wrap mb-1">
                                                                            {currentBid.sig1 && <span className="bg-yellow-900/50 text-yellow-200 border border-yellow-700/50 px-2 py-0.5 rounded font-black text-sm flex items-center gap-1"><Icon className="w-3 h-3 text-yellow-400"><path d="m12 2 3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></Icon>{currentBid.sig1}</span>}
                                                                            {currentBid.sig2 && <span className="bg-yellow-900/50 text-yellow-200 border border-yellow-700/50 px-2 py-0.5 rounded font-black text-sm flex items-center gap-1"><Icon className="w-3 h-3 text-yellow-400"><path d="m12 2 3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></Icon>{currentBid.sig2}</span>}
                                                                            {currentBid.sig3 && <span className="bg-yellow-900/50 text-yellow-200 border border-yellow-700/50 px-2 py-0.5 rounded font-black text-sm flex items-center gap-1"><Icon className="w-3 h-3 text-yellow-400"><path d="m12 2 3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></Icon>{currentBid.sig3}</span>}
                                                                        </div>
                                                                    )}
                                                                    {currentBid.champPool && <p className="text-slate-300">{currentBid.champPool}</p>}
                                                                </div>
                                                            </div>
                                                        )}
                                                        {(currentBid.laningPros || currentBid.laningCons) && (
                                                            <div>
                                                                <span className="text-blue-400 font-bold block mb-1">ğŸ›¡ï¸ ë¼ì¸ì „</span>
                                                                <div className="pl-2 space-y-1">
                                                                    {currentBid.laningPros && <p className="text-blue-200"><span className="text-blue-500 font-bold mr-1">[+]</span>{currentBid.laningPros}</p>}
                                                                    {currentBid.laningCons && <p className="text-red-200"><span className="text-red-500 font-bold mr-1">[-]</span>{currentBid.laningCons}</p>}
                                                                </div>
                                                            </div>
                                                        )}
                                                        {(currentBid.teamfightPros || currentBid.teamfightCons) && (
                                                            <div>
                                                                <span className="text-purple-400 font-bold block mb-1">ğŸ’¥ í•œíƒ€</span>
                                                                <div className="pl-2 space-y-1">
                                                                    {currentBid.teamfightPros && <p className="text-blue-200"><span className="text-blue-500 font-bold mr-1">[+]</span>{currentBid.teamfightPros}</p>}
                                                                    {currentBid.teamfightCons && <p className="text-red-200"><span className="text-red-500 font-bold mr-1">[-]</span>{currentBid.teamfightCons}</p>}
                                                                </div>
                                                            </div>
                                                        )}
                                                    </div>
                                                )}

                                                <div className="flex flex-col gap-4 max-w-md w-full">
                                                    <div className="relative">
                                                        <input type="number" placeholder="ë‚™ì°° í¬ì¸íŠ¸ ì…ë ¥" value={bidPrice} onChange={(e) => { setBidPrice(e.target.value); setErrorMsg(''); }} className={`w-full text-center bg-slate-950 border rounded-lg p-3 text-2xl font-bold text-white focus:ring-2 focus:ring-yellow-500 outline-none ${errorMsg ? 'border-red-500' : 'border-slate-600'}`} />
                                                        {errorMsg && <p className="text-red-500 text-sm mt-1 font-bold animate-bounce">{errorMsg}</p>}
                                                    </div>
                                                    <div className="grid grid-cols-2 gap-2 md:grid-cols-4">
                                                        {teams.map((team, idx) => {
                                                            const isRoleFilled = team.members.some(member => {
                                                                const playerInfo = players.find(p => p.name === member.name);
                                                                return playerInfo && playerInfo.role === currentBid.role;
                                                            });
                                                            const canAfford = !bidPrice || parseInt(bidPrice) <= team.points;
                                                            const isDisabled = !bidPrice || !canAfford || isRoleFilled;
                                                            return (
                                                                <button key={team.captain} onClick={() => confirmPurchase(idx)} disabled={isDisabled} className={`py-2 px-1 rounded font-bold text-sm transition-colors flex flex-col items-center justify-center ${isDisabled ? 'bg-slate-800 text-slate-500 cursor-not-allowed opacity-70' : 'bg-blue-600 hover:bg-blue-500 text-white'}`}>
                                                                    <span>{team.captain}íŒ€</span>
                                                                    <span className="text-xs font-normal">{isRoleFilled ? '(í¬ì§€ì…˜ ê½‰ì°¸)' : (!canAfford && bidPrice ? '(í¬ì¸íŠ¸ ë¶€ì¡±)' : 'ë‚™ì°°')}</span>
                                                                </button>
                                                            );
                                                        })}
                                                    </div>
                                                    <button onClick={handleUnsold} className="mt-2 w-full bg-red-900/50 hover:bg-red-900 border border-red-800 text-red-200 py-2 rounded-lg font-bold flex items-center justify-center gap-2"><MinusCircle className="w-4 h-4" /> ìœ ì°°ì‹œí‚¤ê¸°</button>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </div>

                                <div className="lg:w-80 bg-slate-900 border border-slate-700 rounded-xl p-4 h-fit">
                                    <h3 className="text-slate-300 font-bold mb-4 flex items-center gap-2 border-b border-slate-700 pb-2"><ListIcon className="w-4 h-4" /> ë‚¨ì€ ë§¤ë¬¼ ({auctionQueue.length})</h3>
                                    <div className="space-y-4">
                                        {ROLES.map(role => {
                                            const remainingInRole = auctionQueue.filter(p => p.role === role).sort((a, b) => TIER_SCORES[b.tier] - TIER_SCORES[a.tier]);
                                            if (remainingInRole.length === 0) return null;
                                            return (
                                                <div key={role}>
                                                    <div className="text-xs font-bold text-slate-500 mb-1">{role}</div>
                                                    <div className="flex flex-wrap gap-2">
                                                        {remainingInRole.map(p => (
                                                            <div key={p.name} className="bg-slate-800 border border-slate-700 px-2 py-1 rounded text-sm flex items-center gap-2">
                                                                <span className="text-slate-200">{p.name}</span>
                                                                <span className={`text-xs font-bold ${TIER_COLORS[p.tier]}`}>{p.tier}</span>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                        {auctionQueue.length === 0 && <div className="text-center text-slate-500 py-4 text-sm">ë‚¨ì€ ë§¤ë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.</div>}
                                    </div>
                                </div>
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 px-4">
                                {teams.map((team) => {
                                    const stats = calculateTeamStats(team.members, players);
                                    return (
                                        <div key={team.captain} className="bg-slate-800 rounded-xl border border-slate-700 overflow-hidden flex flex-col">
                                            <div className="bg-slate-900 p-3 border-b border-slate-700 flex justify-between items-center">
                                                <h3 className="font-bold text-lg text-white">{team.captain} íŒ€</h3>
                                                <div className="text-yellow-400 font-mono font-bold">{team.points} P</div>
                                            </div>
                                            <div className="grid grid-cols-3 bg-slate-800/50 p-2 text-xs border-b border-slate-700 text-center text-slate-300">
                                                <div><div className="text-slate-500">MAX</div><div className={`font-bold ${TIER_COLORS[stats.max] || 'text-white'}`}>{stats.max}</div></div>
                                                <div><div className="text-slate-500">AVG</div><div className="font-bold text-white">{stats.avg}</div></div>
                                                <div><div className="text-slate-500">MIN</div><div className={`font-bold ${TIER_COLORS[stats.min] || 'text-white'}`}>{stats.min}</div></div>
                                            </div>
                                            <div className="p-3 flex-1">
                                                <div className="space-y-2">
                                                    {ROLES.map(role => {
                                                        const member = team.members.find(m => {
                                                            const pData = players.find(p => p.name === m.name);
                                                            return pData && pData.role === role;
                                                        });
                                                        return (
                                                            <div key={role} className="flex items-center justify-between bg-slate-900/50 rounded px-2 py-1.5 h-9">
                                                                <span className="text-xs font-bold text-slate-500 w-8">{role}</span>
                                                                {member ? (
                                                                    <div className="flex items-center gap-2 flex-1 justify-between">
                                                                        <span className="text-sm font-medium text-blue-100">
                                                                            {member.name} 
                                                                            <span className={`text-xs font-bold ml-1 ${TIER_COLORS[players.find(p=>p.name===member.name).tier]}`}>({players.find(p=>p.name===member.name).tier})</span>
                                                                        </span>
                                                                        {member.price > 0 && <span className="text-xs text-yellow-600">-{member.price}</span>}
                                                                    </div>
                                                                ) : <span className="text-xs text-slate-700">- ê³µì„ -</span>}
                                                            </div>
                                                        );
                                                    })}
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>

                            {unsoldList.length > 0 && (
                                <div className="mt-8 mx-4 bg-slate-900 p-4 rounded-lg border border-red-900/30">
                                    <h4 className="text-red-400 font-bold mb-2 text-sm flex items-center gap-2"><AlertCircle className="w-4 h-4" /> ìœ ì°°ëœ í”Œë ˆì´ì–´ ëª©ë¡ {currentBid ? "(í˜„ì¬ ê²½ë§¤ ì¤‘ì—ëŠ” ì„ íƒ ë¶ˆê°€)" : "(í´ë¦­í•˜ì—¬ ì¬ê²½ë§¤)"}</h4>
                                    <div className="flex flex-wrap gap-2">
                                        {unsoldList.map(p => (
                                            <button key={p.name} onClick={() => reviveUnsoldPlayer(p)} disabled={!!currentBid} className={`px-3 py-1 rounded text-sm border border-slate-700 flex items-center gap-1 transition-all ${currentBid ? 'bg-slate-800 opacity-50 cursor-not-allowed text-slate-600' : 'bg-slate-800 hover:bg-slate-700 hover:border-blue-500 cursor-pointer text-slate-300'}`}>
                                                <span className={currentBid ? "" : "group-hover:text-white"}>{p.role}</span>
                                                <span className={currentBid ? "" : ""}>{p.name}</span>
                                                <span className={`font-bold ${TIER_COLORS[p.tier]}`}>({p.tier})</span>
                                                {!currentBid && <RotateCcw className="w-3 h-3 text-slate-600 ml-1" />}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<LoLAuctionApp />);
    </script>
</body>

</html>
